const pieces=["black","black-king","red","red-king","empty"],movingDys=[[-1],[-1,1],[1],[-1,1]],eatingDys=movingDys.map(e=>e.map(e=>2*e)),colors=["black","red"],EMPTY_VALUE=pieces.length-1,clsx=(...e)=>{var t=Object.entries(e.pop()).filter(([,e])=>Boolean(e)).map(([e])=>e);return[...e,...t].join(" ")},defaultSetup={turn:"black",grid:`
-r-r-r-r
r-r-r-r-
-r-r-r-r
--------
--------
b-b-b-b-
-b-b-b-b
b-b-b-b-
`.trim().split("\n").filter(Boolean).join("\n")};class GridUpdate{constructor(e,t,r=EMPTY_VALUE){this.indices={row:e,column:t},this.value=r}static updateFactory(e,t,...r){let a=[];return a.push(new GridUpdate(e.finalRow,e.finalColumn,t)),r.forEach(({indices:e})=>a.push(new GridUpdate(e.row,e.column))),a}}function forEach(r){for(let t=0;t<8;t++)for(let e=0;e<8;e++)r(t,e)}const trailingTranslate=(e,t)=>`translateX(${e}px) translateY(${t}px)`,dom=(()=>{var e=e=>document.getElementById(e);const r=e("table"),s=e("turnDiv"),g=e("trailingDiv"),m=e("containerBoard"),t=e("reset"),a=e("share"),i=e("undo"),d=e("redo"),[o,n,l,u,c]=["click","mousedown","mouseover","keydown","touchstart"].map(r=>(e,t)=>e.addEventListener(r,t)),p="can-move",h=pieces.map((e,t)=>"piece-"+pieces[t]),f=h[EMPTY_VALUE],v=Object.fromEntries(colors.map(e=>[e,"piece-"+e])),C=(e,t)=>r.rows[e].cells[t],w=e=>{const r=new Set(e.map(({row:e,column:t})=>e+","+t));return(e,t)=>r.has(e+","+t)};let E=!1;const T=r=>forEach((e,t)=>r({row:e,column:t,domCell:C(e,t)}));function L(e,{moveEvent:r,endEvent:t,coordsExtractor:a}){var{clientX:o,clientY:n}=a(e);console.log({clientX:o,clientY:n});let{row:l,column:s}=F({clientX:o,clientY:n});var i=new Set(C(l,s).classList),i=i.has.bind(i);if(i(p)&&!i(f)){E=!0,m.addEventListener(r,d),m.addEventListener(t,function(e){m.removeEventListener(r,d),g.style.backgroundImage="",g.style.transform=trailingTranslate(-1e3,-1e3),E=!1;var{row:e,column:t}=F(a(e));BoardState.handleMove(e,t,l,s)},{once:!0}),g.className=h.find(i);const{width:u,height:c}=g.getBoundingClientRect();t=state.getLegalTargets(l,s);function d(e){var{clientX:e,clientY:t}=a(e);g.style.transform=trailingTranslate(e-u/2,t-c/2)}state.updatedGrid([new GridUpdate(l,s,EMPTY_VALUE)]).updateUI(t),console.log(e),g.style.transform=trailingTranslate(o-u/2,n-c/2)}}n(r,e=>{L(e,{moveEvent:"mousemove",endEvent:"mouseup",coordsExtractor:e=>e})}),c(r,e=>{L(e,{moveEvent:"touchmove",endEvent:"touchend",coordsExtractor:e=>e.changedTouches[0]})});let{left:S,top:M,width:U,height:b}=r.getBoundingClientRect();function F({clientX:e,clientY:t}){e-=S+window.pageXOffset,t-=M+window.pageYOffset;return e>U||t>b?{row:-1,column:-1}:{row:Math.floor(t/b*8),column:Math.floor(e/U*8)}}return window.onresize=()=>({left:S,top:M,width:U,height:b}=r.getBoundingClientRect()),{updateUI({grid:e,turn:t,legalTargets:r,piecesThatCanMove:a}){{var[o,{legalTargets:e,piecesThatCanMove:r,turn:a}]=[e,{legalTargets:r,piecesThatCanMove:a,turn:t}];s.className=v[a],i.disabled=0===idx,d.disabled=idx===stack.length-1;const n=w(e),l=w(r);T(({row:e,column:t,domCell:r})=>{var a=o[e][t],a=clsx(h[a],{"legal-target":n(e,t),"can-move":l(e,t)&&!E});r.className!==a&&(r.className=a)})}},registerShare:e=>o(a,e),registerUndo:(t,r)=>{o(i,t),o(d,r),u(window,({key:e})=>{"ArrowLeft"!==e||i.disabled||t(),"ArrowRight"!==e||d.disabled||r()})},registerReset:e=>o(t,e),registerHover(a){T(({domCell:e,row:t,column:r})=>{l(e,()=>a(t,r))})},toast:function(e,t=2e3){const r=document.createElement("div");r.classList.add("toast"),r.innerText=e,document.body.appendChild(r),setTimeout(()=>{document.body.removeChild(r)},t)}}})();class BoardState{constructor(e,t,{flaggedCell:r}={}){this.grid=e,this.currentTurn=t,this.flaggedCell=r,this.piecesThatCanMove=this.getPiecesThatCanMove()}updatedGrid(e){e=BoardState.computeGrid(this.grid,e);return new BoardState(e,this.currentTurn)}updateFlaggedCell(e=void 0){return new BoardState(this.grid,this.currentTurn,{flagged:e})}updateCurrentTurn(){var e=this.grid;return new BoardState(e,BoardState.oppositeColor(this.currentTurn))}getPiecesThatCanMove(){return allCellsForColor(this.grid,this.currentTurn).filter(({row:e,column:t})=>this.getLegalTargets(e,t).length)}updateUI(e=[]){return dom.updateUI({grid:this.grid,turn:this.currentTurn,legalTargets:e,piecesThatCanMove:this.piecesThatCanMove}),this}getLegalTargets(e,t){return allLogicalLegalMovesForCell(this,{startRow:e,startColumn:t}).map(({finalCell:e})=>e)}static oppositeColor(e){return e===colors[0]?colors[1]:colors[0]}static computeGrid(e,t){let a=deepCopy2DArr(e);return t.forEach(({indices:{row:e,column:t},value:r})=>{a[e][t]=r}),a}static handleMove(e,t,r,a){if(state.grid[e][t]!==EMPTY_VALUE||-1===e&&-1===t)return state.updateUI();var o,r=generateGridUpdatesForMoveIfLegal(state,{finalRow:e,finalColumn:t,startRow:r,startColumn:a}),r=(0<r.length&&(a=state.updatedGrid(r),r=3===r.length&&"king"!==pieces[r[r.length-1].value].split("-")[1]||4===r.length,o=0!==allLegalEatingMovesForCell(a.grid,e,t).length,didColorLose((state=r&&o?a.updateFlaggedCell({row:e,column:t}):a.updateFlaggedCell().updateCurrentTurn()).grid,state.currentTurn)&&(dom.toast(state.currentTurn+" lost! :(",5e3),resetGame())),state.updateUI(),state.serialize());store.state=r,stack[++idx]=r,stack.splice(idx+1)}static startSession({grid:e,turn:t}){const a=changeGridStringToNumbers(e).trim().split("\n").map(e=>e.trim());e=new Array(a.length).fill(new Array(a[0].length).fill(0)).map((e,r)=>e.map((e,t)=>Number(a[r].charAt(t))));return new BoardState(e,t).updateUI()}serialize(){const t=["b","B","r","R","-"];return{grid:this.grid.map(e=>e.map(e=>t[e]).join("")).join("\n"),turn:this.currentTurn}}}function generateGridUpdatesForMoveIfLegal(e,{finalRow:t,finalColumn:r,startRow:a,startColumn:o}){var n=allLogicalLegalMovesForCell(e,{startRow:a,startColumn:o}).find(({finalCell:e})=>e.row===t&&e.column===r);return n?(n=n["updates"],(7===t||0===t)&&0<n.length&&n.push(new GridUpdate(t,r,pieces.indexOf(colorForCell(e.grid[a][o])+"-king"))),n):[]}function allLogicalLegalMovesForCell({grid:e,flaggedCell:t,currentTurn:r},{startRow:a,startColumn:o}){var n=e[a][o];return n===EMPTY_VALUE||colorForCell(n)!==r||a===t?.row&&o===t?.column?[]:(isThereAnEatingPossibilityForGivenColor(e,colorForCell(e[a][o]))?allLegalEatingMovesForCell:allLegalNonEatingMovesForCell)(e,a,o)}function isThereAnEatingPossibilityForGivenColor(r,e){return allCellsForColor(r,e).some(({row:e,column:t})=>0<allLegalEatingMovesForCell(r,e,t).length)}function colorForCell(e){return e!==EMPTY_VALUE?pieces[e].split("-")[0]:"empty"}function allLegalEatingMovesForCell(e,t,r){var a=[2,-2],o=[],n=e[t][r];if(n!==EMPTY_VALUE)for(var l of eatingDys[n])for(var s of a){var i,d,u,c=t+l,g=r+s;areRowsOutOfBounds(c)||areColumnsOutOfBounds(g)||(i=e[c][g],d=t+(Math.abs(l)-1)*Math.sign(l),s=r+(Math.abs(s)-1)*Math.sign(s),u=e[d][s],i===EMPTY_VALUE&&colorForCell(u)===BoardState.oppositeColor(colorForCell(n))&&o.push({finalCell:{row:c,column:g},updates:GridUpdate.updateFactory({finalRow:c,finalColumn:g},n,new GridUpdate(d,s),new GridUpdate(t,r))}))}return o}function allLegalNonEatingMovesForCell(e,t,r){var a=[1,-1],o=[],n=e[t][r];if(n!==EMPTY_VALUE)for(var l of movingDys[n])for(var s of a){var i=t+l,s=r+s;areRowsOutOfBounds(i)||areColumnsOutOfBounds(s)||e[i][s]===EMPTY_VALUE&&o.push({finalCell:{row:i,column:s},updates:GridUpdate.updateFactory({finalRow:i,finalColumn:s},n,new GridUpdate(t,r))})}return o}function allCellsForColor(r,a){const o=[];return forEach((e,t)=>{colorForCell(r[e][t])===a&&o.push({row:e,column:t})}),o}function didColorLose(r,e){return!allCellsForColor(r,e).some(({row:e,column:t})=>0<allLegalEatingMovesForCell(r,e,t).length||0<allLegalNonEatingMovesForCell(r,e,t).length)}const deepCopy2DArr=e=>e.map(e=>e.map(e=>e));function areRowsOutOfBounds(...e){return e.some(e=>8<=e||e<0)}function areColumnsOutOfBounds(...e){return e.some(e=>8<=e||e<0)}function changeGridStringToNumbers(e){return["b","B","r","R","-"].reduce((e,t,r)=>e.replaceAll(t,r),e)}const storageBackend=(()=>{const a="state",o="grid",n="turn",{pathname:l,href:s}=window.location,i=()=>{return(window.location.search?(e=new URLSearchParams(window.location.search),t=e.get(o),e=e.get(n),t?{grid:t,turn:e}:void 0):(()=>{try{return JSON.parse(localStorage.getItem(a))}catch(e){}})())||defaultSetup;var e,t};return{fetch:i,persist:({grid:e,turn:t}=defaultSetup)=>{var r=new URLSearchParams;r.set(o,e),r.set(n,t),history.pushState(null,"",l+"?"+r.toString()),localStorage.setItem(a,JSON.stringify({grid:e,turn:t}))},reset:()=>{history.pushState(null,"",l),localStorage.removeItem(a)},compileSharingUrl:function(){var e=new URLSearchParams,{grid:t,turn:r}=i();return e.set(o,t),e.set(n,r),s.split("?")[0]+"?"+e.toString()}}})(),store=(()=>{const{fetch:e,persist:r,reset:t,compileSharingUrl:a}=storageBackend;return{get state(){return e()},set state({grid:e,turn:t}){r({grid:e,turn:t})},reset:t,get share(){return a()}}})();function resetGame(){state=BoardState.startSession(defaultSetup),stack=[defaultSetup],idx=0,store.reset()}dom.registerShare(()=>{navigator.clipboard.writeText(store.share).then(()=>{dom.toast("URL with game-state copied to clipboard! ðŸŽ†ðŸŽ†ðŸŽ†")})}),dom.registerReset(resetGame),dom.registerHover((e,t)=>state.updateUI(state.getLegalTargets(e,t))),dom.registerUndo(()=>{state=BoardState.startSession(stack[--idx]),store.state=state.serialize()},()=>{state=BoardState.startSession(stack[++idx]),store.state=state.serialize()});let stack=[store.state],idx=0,state=BoardState.startSession(store.state);
//# sourceMappingURL=index.min.js.map