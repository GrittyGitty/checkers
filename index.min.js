const pieces=["black","black-king","red","red-king","empty"],colors=["black","red"],clsx=(...e)=>{var t=Object.entries(e.pop()).filter(([,e])=>Boolean(e)).map(([e])=>e);return[...e,...t].join(" ")},EMPTY_VALUE=pieces.length-1,defaultSetup={turn:"red",grid:`
-b-b-b-b
b-b-b-b-
-b-b-b-b
--------
--------
r-r-r-r-
-r-r-r-r
r-r-r-r-
`.trim().split("\n").filter(Boolean).join("\n")};class GridUpdate{constructor(e,t,r=EMPTY_VALUE){this.indices={row:e,column:t},this.value=r}static updateFactory(e,t,...r){let o=[];return o.push(new GridUpdate(e.finalRow,e.finalColumn,t)),r.forEach(({indices:e})=>o.push(new GridUpdate(e.row,e.column))),o}}function forEach(r){for(let t=0;t<8;t++)for(let e=0;e<8;e++)r(t,e)}const dom=(()=>{const r=document.getElementById("table"),i=document.getElementById("turnDiv"),s=document.getElementById("trailingDiv"),u=document.getElementById("containerBoard"),t=document.getElementById("reset"),o=document.getElementById("share"),d=(e,t)=>r.rows[e].cells[t],c=e=>{const r=new Set(e.map(({row:e,column:t})=>e+","+t));return(e,t)=>r.has(e+","+t)};let g=!1;const p=r=>forEach((e,t)=>r({row:e,column:t,domCell:d(e,t)}));let{left:n,top:a,width:l,height:m}=r.getBoundingClientRect();function h(e){var t,r=n+window.pageXOffset,o=a+window.pageYOffset,r=e.clientX-r,e=e.clientY-o;return r>l||e>m?{row:-1,column:-1}:(o=state.grid.length,t=state.grid[0].length,{row:Math.floor(e/m*o),column:Math.floor(r/l*t)})}return r.addEventListener("mousedown",function(e){g=!0;let{row:o,column:n}=h(e);var t=state.grid[o][n];if(t!==EMPTY_VALUE){u.addEventListener("mousemove",a),u.addEventListener("mouseup",function e(t){g=!1,state.updateUI(),u.removeEventListener("mousemove",a),s.style.backgroundImage="",s.style.top="-1000px",s.style.left="-1000px";var{row:t,column:r}=h(t);BoardState.handleMove(t,r,o,n),u.removeEventListener("mouseup",e)});t=d(o,n);s.className=t.className.split(" ").find(e=>e.startsWith("piece"));const{width:r,height:l}=s.getBoundingClientRect();t=state.getPotentialMoves(o,n);function a(e){s.style.top=e.clientY-l/2+"px",s.style.left=e.clientX-r/2+"px"}state.updatedGrid([new GridUpdate(o,n,EMPTY_VALUE)]).updateUI(t),s.style.top=e.clientY-l/2+"px",s.style.left=e.clientX-r/2+"px"}}),window.onresize=()=>({left:n,top:a,width:l,height:m}=r.getBoundingClientRect()),{updateUI({grid:e,turn:t,potentialMoves:r,piecesThatCanMove:o}){i.style.backgroundColor=t;{var[n,{potentialMoves:t,piecesThatCanMove:e}]=[e,{potentialMoves:r,piecesThatCanMove:o}];const a=c(t),l=c(e);p(({row:e,column:t,domCell:r})=>{var o=n[e][t],o=clsx("piece-"+pieces[o],{tograb:o!==EMPTY_VALUE,"potential-move":a(e,t),"can-move":l(e,t)&&!g});r.className!==o&&(r.className=o)})}},registerShare(e){o.addEventListener("click",e)},registerReset(e){t.addEventListener("click",e)},registerHover(o){p(({domCell:e,row:t,column:r})=>{e.addEventListener("mouseover",()=>o(t,r))})},toast:function(e,t=2e3){const r=document.createElement("div");r.classList.add("toast"),r.innerText=e,document.body.appendChild(r),setTimeout(()=>{document.body.removeChild(r)},t)}}})();class BoardState{constructor(e,t,{flaggedCell:r}={}){this.grid=e,this.currentTurn=t,this.flaggedCell=r,this.piecesThatCanMove=this.getPiecesThatCanMove()}updatedGrid(e){e=BoardState.computeGrid(this.grid,e);return new BoardState(e,this.currentTurn)}updateFlaggedCell(e=void 0){return new BoardState(this.grid,this.currentTurn,{flagged:e})}updateCurrentTurn(){var e=this.grid;return new BoardState(e,BoardState.oppositeColor(this.currentTurn))}getPiecesThatCanMove(){return allCellsForColor(this.grid,this.currentTurn).filter(({row:e,column:t})=>this.getPotentialMoves(e,t).length)}updateUI(e=[]){return dom.updateUI({grid:this.grid,turn:this.currentTurn,potentialMoves:e,piecesThatCanMove:this.piecesThatCanMove}),this}getPotentialMoves(e,t){return allLogicalLegalMovesForCell(this,{startRow:e,startColumn:t}).map(({finalCell:e})=>e)}static oppositeColor(e){return e===colors[0]?colors[1]:colors[0]}static computeGrid(e,t){let o=deepCopy2DArr(e);return t.forEach(({indices:{row:e,column:t},value:r})=>{o[e][t]=r}),o}static handleMove(e,t,r,o){if(state.grid[e][t]!==EMPTY_VALUE||-1===e&&-1===t)return state.updateUI();var n,r=generateGridUpdatesForMoveIfLegal(state,{finalRow:e,finalColumn:t,startRow:r,startColumn:o});0<r.length&&(o=state.updatedGrid(r),r=3===r.length&&"king"!==pieces[r[r.length-1].value].split("-")[1]||4===r.length,n=0!==allLegalEatingMovesForCell(o.grid,e,t).length,didColorLose((state=r&&n?o.updateFlaggedCell({row:e,column:t}):o.updateFlaggedCell().updateCurrentTurn()).grid,state.currentTurn)&&(dom.toast(state.currentTurn+" lost! :(",5e3),resetGame())),state.updateUI(),store.state=state.serialize()}static startSession({grid:e,turn:t}){const o=changeGridStringToNumbers(e).trim().split("\n").map(e=>e.trim());e=new Array(o.length).fill(new Array(o[0].length).fill(0)).map((e,r)=>e.map((e,t)=>Number(o[r].charAt(t))));return new BoardState(e,t).updateUI()}serialize(){const t=["b","B","r","R","-"];return{grid:this.grid.map(e=>e.map(e=>t[e]).join("")).join("\n"),turn:this.currentTurn}}}function generateGridUpdatesForMoveIfLegal(e,{finalRow:t,finalColumn:r,startRow:o,startColumn:n}){var a=allLogicalLegalMovesForCell(e,{startRow:o,startColumn:n}).find(({finalCell:e})=>e.row===t&&e.column===r);return a?(a=a["updates"],(t===e.grid.length-1||0===t)&&0<a.length&&a.push(new GridUpdate(t,r,pieces.indexOf(colorForCell(e.grid[o][n])+"-king"))),a):[]}function allLogicalLegalMovesForCell({grid:e,flaggedCell:t,currentTurn:r},{startRow:o,startColumn:n}){var a=e[o][n];return a===EMPTY_VALUE||colorForCell(a)!==r||o===t?.row&&n===t?.column?[]:(isThereAnEatingPossibilityForGivenColor(e,colorForCell(e[o][n]))?allLegalEatingMovesForCell:allLegalNonEatingMovesForCell)(e,o,n)}function isThereAnEatingPossibilityForGivenColor(r,e){return allCellsForColor(r,e).some(({row:e,column:t})=>0<allLegalEatingMovesForCell(r,e,t).length)}function colorForCell(e){return e!==EMPTY_VALUE?pieces[e].split("-")[0]:"empty"}function allLegalEatingMovesForCell(e,t,r){var o,n=[2,-2],a=[2,-2],l=[],i=e[t][r];if(i!==EMPTY_VALUE)for(o of pieces[i].includes("king")?n:[n[colors.indexOf(colorForCell(e[t][r]))]])for(var s of a){var u,d,c,g=t+o,p=r+s;areRowsOutOfBounds(g)||areColumnsOutOfBounds(p)||(u=e[g][p],d=t+(Math.abs(o)-1)*Math.sign(o),s=r+(Math.abs(s)-1)*Math.sign(s),c=e[d][s],u===EMPTY_VALUE&&colorForCell(c)===BoardState.oppositeColor(colorForCell(i))&&l.push({finalCell:{row:g,column:p},updates:GridUpdate.updateFactory({finalRow:g,finalColumn:p},i,new GridUpdate(d,s),new GridUpdate(t,r))}))}return l}function allLegalNonEatingMovesForCell(e,t,r){var o,n=[1,-1],a=[1,-1],l=[],i=e[t][r];if(i!==EMPTY_VALUE)for(o of pieces[i].includes("king")?n:[n[colors.indexOf(colorForCell(e[t][r]))]])for(var s of a){var u=t+o,s=r+s;areRowsOutOfBounds(u)||areColumnsOutOfBounds(s)||e[u][s]===EMPTY_VALUE&&l.push({finalCell:{row:u,column:s},updates:GridUpdate.updateFactory({finalRow:u,finalColumn:s},i,new GridUpdate(t,r))})}return l}function allCellsForColor(r,o){const n=[];return forEach((e,t)=>{colorForCell(r[e][t])===o&&n.push({row:e,column:t})}),n}function didColorLose(r,e){return!allCellsForColor(r,e).some(({row:e,column:t})=>0<allLegalEatingMovesForCell(r,e,t).length||0<allLegalNonEatingMovesForCell(r,e,t).length)}const deepCopy2DArr=e=>e.map(e=>e.map(e=>e));function areRowsOutOfBounds(...e){return e.some(e=>8<=e||e<0)}function areColumnsOutOfBounds(...e){return e.some(e=>8<=e||e<0)}function changeGridStringToNumbers(e){return["b","B","r","R","-"].reduce((e,t,r)=>e.replaceAll(t,r),e)}const storageBackend=(()=>{const o="state",n="grid",a="turn",{pathname:l,href:i}=window.location,s=()=>{return(window.location.search?(e=new URLSearchParams(window.location.search),t=e.get(n),e=e.get(a),t?{grid:t,turn:e}:void 0):(()=>{try{return JSON.parse(localStorage.getItem(o))}catch(e){}})())||defaultSetup;var e,t};return{fetch:s,persist:({grid:e,turn:t}=defaultSetup)=>{var r=new URLSearchParams;r.set(n,e),r.set(a,t),history.pushState(null,"",l+"?"+r.toString()),localStorage.setItem(o,JSON.stringify({grid:e,turn:t}))},reset:()=>{history.pushState(null,"",l),localStorage.removeItem(o)},compileSharingUrl:function(){var e=new URLSearchParams,{grid:t,turn:r}=s();return e.set(n,t),e.set(a,r),i.split("?")[0]+"?"+e.toString()}}})(),store=(()=>{const{fetch:e,persist:r,reset:t,compileSharingUrl:o}=storageBackend;return{get state(){return e()},set state({grid:e,turn:t}){r({grid:e,turn:t})},reset:t,get share(){return o()}}})();function resetGame(){state=BoardState.startSession(defaultSetup),store.reset()}dom.registerShare(()=>{navigator.clipboard.writeText(store.share).then(()=>{dom.toast("URL with game-state copied to clipboard! ðŸŽ†ðŸŽ†ðŸŽ†")})}),dom.registerReset(resetGame),dom.registerHover((e,t)=>state.updateUI(state.getPotentialMoves(e,t)));let state=BoardState.startSession(store.state);
//# sourceMappingURL=index.min.js.map