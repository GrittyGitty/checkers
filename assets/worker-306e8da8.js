var N=Object.defineProperty;var V=(c,u,g)=>u in c?N(c,u,{enumerable:!0,configurable:!0,writable:!0,value:g}):c[u]=g;var C=(c,u,g)=>(V(c,typeof u!="symbol"?u+"":u,g),g);(function(){"use strict";var c=(n=>(n.black="black",n.red="red",n))(c||{});const u=["black","black-king","red","red-king","empty"],g=[[-1],[-1,1],[1],[-1,1]],x=g.map(n=>n.map(e=>e*2)),v=[c.black,c.red],d=u.length-1;c.red;class p{constructor(e,t,o=d){C(this,"indices");C(this,"value");this.indices={row:e,column:t},this.value=o}static updateFactory(e,t,...o){const s=[];return s.push(new p(e.finalRow,e.finalColumn,t)),o.forEach(({indices:r})=>s.push(new p(r.row,r.column))),s}}function m(n){for(let e=0;e<8;e++)for(let t=0;t<8;t++)n(e,t)}const b=u.map((n,e)=>e!==d?u[e].split("-")[0]:void 0);function M(n){return n===v[0]?v[1]:v[0]}c.black,`
-r-r-r-r
r-r-r-r-
-r-r-r-r
--------
--------
b-b-b-b-
-b-b-b-b
b-b-b-b-
`.trim().split(`
`).filter(Boolean).join(`
`);function w({grid:n,turn:e},{startRow:t,startColumn:o}){const s=n[t][o];return s===d||b[s]!==e?[]:A(n,b[n[t][o]])?y(n,t,o):D(n,t,o)}function A(n,e){return F(n,e).some(({row:t,column:o})=>y(n,t,o).length>0)}function y(n,e,t){const o=[2,-2],s=[],r=n[e][t];if(r===d)return s;for(const i of x[r])for(const l of o){const a=e+i,f=t+l;if(L(a)||E(f))continue;const T=n[a][f],k=e+(Math.abs(i)-1)*Math.sign(i),G=t+(Math.abs(l)-1)*Math.sign(l),B=n[k][G];T===d&&b[B]===M(b[r])&&s.push({finalCell:{row:a,column:f},updates:p.updateFactory({finalRow:a,finalColumn:f},r,new p(k,G),new p(e,t))})}return s}function F(n,e){const t=[];return m((o,s)=>{b[n[o][s]]===e&&t.push({row:o,column:s})}),t}const P=n=>n.map(e=>e.map(t=>t));function L(...n){return n.some(e=>e>=8||e<0)}function E(...n){return n.some(e=>e>=8||e<0)}function D(n,e,t){const o=[1,-1],s=[],r=n[e][t];if(r===d)return s;for(const i of g[r])for(const l of o){const a=e+i,f=t+l;if(L(a)||E(f))continue;n[a][f]===d&&s.push({finalCell:{row:a,column:f},updates:p.updateFactory({finalRow:a,finalColumn:f},r,new p(e,t))})}return s}class h{constructor({grid:e,turn:t,flaggedCell:o,lastMove:s}){C(this,"grid");C(this,"turn");C(this,"flaggedCell");C(this,"lastMove");this.grid=e,this.turn=t,this.flaggedCell=o,this.lastMove=s}updatedGrid(e){return new h({...this,grid:h.computeGrid(this.grid,e)})}updateFlaggedCell(e){return new h({...this,flaggedCell:e})}updateLastMove(e){return new h({...this,lastMove:e})}updateCurrentTurn(){return new h({...this,grid:this.grid,turn:M(this.turn)})}getAllLegalMovesForColor(){return this.effectivePieces.map(e=>[e,w(this,{startRow:e.row,startColumn:e.column})]).filter(([,e])=>e.length)}get piecesThatCanMove(){return this.effectivePieces.filter(({row:e,column:t})=>this.getLegalTargets(e,t).length)}get effectivePieces(){return this.flaggedCell!=null?[this.flaggedCell]:F(this.grid,this.turn)}getLegalTargets(e,t){return w(this,{startRow:e,startColumn:t}).map(({finalCell:o})=>o)}static computeGrid(e,t){const o=P(e);return t.forEach(({indices:{row:s,column:r},value:i})=>{o[s][r]=i}),o}serialize(){const e=["b","B","r","R","-"];return{grid:this.grid.map(t=>t.map(o=>e[o]).join("")).join(`
`),turn:this.turn}}static deserialize(e){return new h(e)}}const O=[1,1,1,1,0],j=({grid:n,turn:e})=>{let t=0;return m((o,s)=>{const r=n[o][s],i=b[r];if(!i)return;const l=O[r];t+=i===e?l:-l}),t};function z(n,e){let t=0;const o=[{state:n,depth:e}];let s;for(;s=o.pop();){const{state:r,depth:i}=s;if(!i){const l=j(r);l>=t&&(t=l);continue}for(const[,l]of r.getAllLegalMovesForColor())for(const{updates:a}of l)o.push({state:r.updatedGrid(a).updateCurrentTurn(),depth:i-1})}return t}self.addEventListener("message",({data:n})=>{const e=h.deserialize(n.state),t=String(e.grid),s={score:z(e,n.depth),stringGrid:t};postMessage(s)})})();
//# sourceMappingURL=worker-306e8da8.js.map
