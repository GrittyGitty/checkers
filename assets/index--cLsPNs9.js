var Re=Object.defineProperty;var ke=(e,t,n)=>t in e?Re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var b=(e,t,n)=>(ke(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var F=(e=>(e.black="black",e.red="red",e))(F||{});const y=["black","black-king","red","red-king","empty"],ae=[[-1],[-1,1],[1],[-1,1]],Pe=ae.map(e=>e.map(t=>t*2)),U=[F.black,F.red],h=y.length-1,xe=F.red;function le(e){for(let t=0;t<8;t++)for(let n=0;n<8;n++)e(t,n)}const $=y.map((e,t)=>t!==h?y[t].split("-")[0]:void 0);function Ne(e){return["b","B","r","R","-"].reduce((t,n,r)=>t.replaceAll(n,String(r)),e)}function ue(e){return e===U[0]?U[1]:U[0]}const z={turn:F.black,grid:`
-r-r-r-r
r-r-r-r-
-r-r-r-r
--------
--------
b-b-b-b-
-b-b-b-b
b-b-b-b-
`.trim().split(`
`).filter(Boolean).join(`
`)},Ue=e=>{const t=Ne(e).trim().split(`
`).map(r=>r.trim());return Array.from({length:8},()=>Array.from({length:8})).map((r,o)=>r.map((s,i)=>Number(t[o].charAt(i))))};class f{constructor(t,n,r=h){b(this,"indices");b(this,"value");this.indices={row:t,column:n},this.value=r}static updateFactory(t,n,...r){const o=[];o.push(new f(t.finalRow,t.finalColumn,n));for(const{indices:s}of r)o.push(new f(s.row,s.column));return o}}function Ge(e,{finalRow:t,finalColumn:n,startRow:r,startColumn:o}){const i=H(e,{startRow:r,startColumn:o}).find(({finalCell:c})=>c.row===t&&c.column===n);if(i==null)return[];const{updates:a}=i;return(t===7||t===0)&&a.length>0&&a.push(new f(t,n,y.indexOf(`${$[e.grid[r][o]]}-king`))),a}function H({grid:e,turn:t},{startRow:n,startColumn:r}){const o=e[n][r];return o===h||$[o]!==t?[]:Ie(e,$[e[n][r]])?B(e,n,r):fe(e,n,r)}function Ie(e,t){return Q(e,t).some(({row:n,column:r})=>B(e,n,r).length>0)}function B(e,t,n){const r=[2,-2],o=[],s=e[t][n];if(s===h)return o;for(const i of Pe[s])for(const a of r){const c=t+i,l=n+a;if(de(c)||ge(l))continue;const g=e[c][l],v=t+(Math.abs(i)-1)*Math.sign(i),d=n+(Math.abs(a)-1)*Math.sign(a),O=e[v][d];g===h&&$[O]===ue($[s])&&o.push({finalCell:{row:c,column:l},updates:f.updateFactory({finalRow:c,finalColumn:l},s,new f(v,d),new f(t,n))})}return o}function Q(e,t){const n=[];return le((r,o)=>{$[e[r][o]]===t&&n.push({row:r,column:o})}),n}function ze(e,t){return!Q(e,t).some(({row:n,column:r})=>B(e,n,r).length>0||fe(e,n,r).length>0)}const Be=e=>e.map(t=>t.map(n=>n));function de(...e){return e.some(t=>t>=8||t<0)}function ge(...e){return e.some(t=>t>=8||t<0)}function fe(e,t,n){const r=[1,-1],o=[],s=e[t][n];if(s===h)return o;for(const i of ae[s])for(const a of r){const c=t+i,l=n+a;if(de(c)||ge(l))continue;e[c][l]===h&&o.push({finalCell:{row:c,column:l},updates:f.updateFactory({finalRow:c,finalColumn:l},s,new f(t,n))})}return o}class p{constructor({grid:t,turn:n,flaggedCell:r,lastMove:o}){b(this,"grid");b(this,"turn");b(this,"flaggedCell");b(this,"lastMove");this.grid=t,this.turn=n,this.flaggedCell=r,this.lastMove=o}updatedGrid(t){return new p({...this,grid:p.computeGrid(this.grid,t)})}updateFlaggedCell(t){return new p({...this,flaggedCell:t})}updateLastMove(t){return new p({...this,lastMove:t})}updateCurrentTurn(){return new p({...this,grid:this.grid,turn:ue(this.turn)})}getAllLegalMovesForColor(){return this.effectivePieces.map(t=>[t,H(this,{startRow:t.row,startColumn:t.column})]).filter(([,t])=>t.length)}get piecesThatCanMove(){return this.effectivePieces.filter(({row:t,column:n})=>this.getLegalTargets(t,n).length)}get effectivePieces(){return this.flaggedCell!=null?[this.flaggedCell]:Q(this.grid,this.turn)}getLegalTargets(t,n){return H(this,{startRow:t,startColumn:n}).map(({finalCell:r})=>r)}static computeGrid(t,n){const r=Be(t);for(const{indices:{row:o,column:s},value:i}of n)r[o][s]=i;return r}serialize(){const t=["b","B","r","R","-"];return{grid:this.grid.map(n=>n.map(r=>t[r]).join("")).join(`
`),turn:this.turn}}static deserialize(t){return new p(t)}}const Z="state",ee="grid",te="turn",{pathname:he,href:Ye}=window.location,Xe=()=>{try{const e=localStorage.getItem(Z);if(!e)throw new Error("State Not Found");return JSON.parse(e)}catch{}},Ve=()=>{const e=new URLSearchParams(window.location.search),t=e.get(ee),n=e.get(te);return t?{grid:t,turn:n}:void 0},me=()=>(window.location.search?Ve():Xe())||z,We=({grid:e,turn:t}=z)=>{const n=new URLSearchParams;n.set(ee,e),n.set(te,t),history.pushState(null,"",`${he}?${n.toString()}`),localStorage.setItem(Z,JSON.stringify({grid:e,turn:t}))},je=()=>{history.pushState(null,"",he),localStorage.removeItem(Z)};function He(){const e=new URLSearchParams,{grid:t,turn:n}=me();return e.set(ee,t),e.set(te,n),`${Ye.split("?")[0]}?${e.toString()}`}const _e={fetch:me,persist:We,reset:je,compileSharingUrl:He},{fetch:qe,persist:Je,reset:Ke,compileSharingUrl:Qe}=_e,M={get serialized(){return qe()},set serialized({grid:e,turn:t}){Je({grid:e,turn:t})},reset:Ke,get share(){return Qe()}};let S=[M.serialized],E=0;const A={resetStack:()=>{S=[z],E=0},add:e=>{S[++E]=e,S.splice(E+1)},dec:()=>S[--E],inc:()=>S[++E],get isEmpty(){return E===0},get isEnd(){return E===S.length-1}},L={ai:!0,depth:5,toggleAi(){return this.ai=!this.ai,this.ai}},m=e=>{const t=document.getElementById(e);if(t==null)throw new Error(`${e} element does not exist`);return t},R=m("table"),Ze=m("turnDiv"),N=m("trailingDiv"),W=m("containerBoard"),et=m("reset"),tt=m("share"),_=m("undo"),q=m("redo"),pe=m("ai"),ve=m("depth");pe.checked=L.ai;ve.value=String(L.depth);const P=e=>(t,n)=>{t.addEventListener(e,n)},D=P("click"),nt=P("mousedown"),rt=P("mouseover"),ot=P("touchstart"),st=P("change");st(ve,e=>{const{valueAsNumber:t}=e.target;L.depth=t});const it="legal-target",we="can-move",ct="move-source",at="move-destination",ne=y.map((e,t)=>`piece-${y[t]}`),lt=ne[h],ut=Object.fromEntries(U.map(e=>[e,`piece-${e}`])),Ce=(e,t)=>R.rows[e].cells[t],ie=e=>{const t=new Set(e.map(({row:n,column:r})=>`${n},${r}`));return(n,r)=>t.has(`${n},${r}`)};let G=!1;const be=e=>{le((t,n)=>{e(t,n,Ce(t,n))})},dt=({grid:e,turn:t,lastMove:n,piecesThatCanMove:r},o)=>{Ze.className=ut[t],_.disabled=A.isEmpty,q.disabled=A.isEnd;const s=ie(o),i=ie(r);be((a,c,l)=>{const g=e[a][c];let d=`${ne[g]} `;if(n){const{startRow:O,startColumn:Y,finalRow:x,finalColumn:X}=n;O===a&&Y===c?d+=`${ct} `:x===a&&X===c&&(d+=`${at} `)}s(a,c)&&(d+=`${it} `),!G&&i(a,c)&&(d+=we),l.className!==d&&(l.className=d)})},gt=e=>{nt(R,n=>{t(n,{moveEvent:"mousemove",endEvent:"mouseup",coordsExtractor:r=>r})}),ot(R,n=>{t(n,{moveEvent:"touchmove",endEvent:"touchend",coordsExtractor:r=>r.changedTouches[0]})});function t(n,{moveEvent:r,endEvent:o,coordsExtractor:s}){const{clientX:i,clientY:a}=s(n),{row:c,column:l}=ce({clientX:i,clientY:a}),g=new Set(Array.from(Ce(c,l).classList)),v=g.has.bind(g);if(!v(we)||v(lt))return;G=!0,W.addEventListener(r,se),W.addEventListener(o,Fe,{once:!0});const d=ne.find(v);typeof d=="string"&&(N.className=d);const{width:O,height:Y}=N.getBoundingClientRect();e.updateUI(c,l);const x=(w,C)=>{N.style.transform=`translateX(${w}px) translateY(${C}px)`},{x:X,y:Ae}=Me({clientX:i,clientY:a}),Oe=X%O,De=Ae%Y,oe=({clientX:w,clientY:C})=>{x(w-Oe,C-De)};oe({clientX:i,clientY:a});function se(w){const{clientX:C,clientY:V}=s(w);oe({clientX:C,clientY:V})}function Fe(w){W.removeEventListener(r,se),N.style.backgroundImage="",x(-1e3,-1e3),G=!1;const{row:C,column:V}=ce(s(w));e.handleMove(C,V,c,l)}}};let{left:Ee,top:ye,width:J,height:K}=R.getBoundingClientRect();window.onresize=()=>{const e=R.getBoundingClientRect();Ee=e.left,ye=e.top,J=e.width,K=e.height};function Me({clientX:e,clientY:t}){const n=Ee+window.pageXOffset,r=ye+window.pageYOffset,o=e-n,s=t-r;return{x:o,y:s}}function ce({clientX:e,clientY:t}){const{x:n,y:r}=Me({clientX:e,clientY:t});return n>J||r>K?{row:-1,column:-1}:{row:Math.floor(r/K*8),column:Math.floor(n/J*8)}}const T={updateDOM({state:e,legalTargets:t}){dt(e,t)},registerShare:e=>{D(tt,e)},registerUndo:(e,t)=>{D(_,e),D(q,t),window.addEventListener("keydown",({key:n})=>{n==="ArrowLeft"&&!_.disabled&&e(),n==="ArrowRight"&&!q.disabled&&t()})},registerReset:e=>{D(et,e)},registerHover(e){be((t,n,r)=>{rt(r,()=>{G||e(t,n)})})},registerDrag(e){gt(e)},registerAi(e){D(pe,()=>{e(L.toggleAi())})}};function ft(e){return new Worker(""+new URL("worker-7v_Ge4FE.js",import.meta.url).href,{name:e==null?void 0:e.name})}const Le=window.navigator.hardwareConcurrency+2,ht=Array.from({length:Le},()=>new ft);let j=0;const mt=()=>{const e=ht[j];return j=(j+1)%Le,e},pt=(e,t)=>new Promise(n=>{const r=mt(),o=String(e.grid);r.addEventListener("message",i);const s={state:e,depth:t};r.postMessage(s);function i({data:{score:a,stringGrid:c}}){o===c&&(n(a),r.removeEventListener("message",i))}}),vt={score:0,move:{finalColumn:0,finalRow:0,startColumn:0,startRow:0}};async function wt(e,t){const n=e.getAllLegalMovesForColor();if(n.length===1&&n[0][1].length===1){const[{row:o,column:s},[{finalCell:i}]]=n[0];return{startRow:o,startColumn:s,finalRow:i.row,finalColumn:i.column}}return(await Promise.all(n.flatMap(([{row:o,column:s},i])=>i.map(({updates:a,finalCell:{row:c,column:l}})=>pt(e.updatedGrid(a).updateCurrentTurn(),t).then(g=>({move:{startRow:o,startColumn:s,finalRow:c,finalColumn:l},score:g})))))).reduce((o,s)=>s.score>=o.score?s:o,vt).move}const Te=(e,t,n)=>{e.turn===xe&&setTimeout(()=>{const r=performance.now();wt(e,n).then(({finalRow:o,finalColumn:s,startRow:i,startColumn:a})=>{const c=performance.now()-r;console.log(`Time elapsed: ${c}ms`);const l=Math.max(200-c,0);setTimeout(()=>{t(o,s,i,a)},l)}).catch(console.error)},50)};function Se(e,t=2e3){const n=document.createElement("div");n.classList.add("toast"),n.innerText=e,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},t)}function re(e,t,n,r){if(u.grid[e][t]!==h||e===-1&&t===-1){k(u);return}const s={finalRow:e,finalColumn:t,startRow:n,startColumn:r},i=Ge(u,s);if(i.length>0){const c=u.updatedGrid(i).updateLastMove(s),l=i.length===3&&y[i[i.length-1].value].split("-")[1]!=="king"||i.length===4,g=B(c.grid,e,t).length!==0;u=l&&g?c.updateFlaggedCell({row:e,column:t}):c.updateFlaggedCell().updateCurrentTurn(),ze(u.grid,u.turn)&&(Se(`${u.turn} lost! :(`,5e3),$e())}k(u);const a=u.serialize();M.serialized=a,A.add(a),L.ai&&Te(u,re,L.depth)}function I({grid:e,turn:t}){const n=Ue(e);return k(new p({grid:n,turn:t}))}let u=I(M.serialized);function $e(){A.resetStack(),M.reset(),u=I(z)}function k(e,t=[]){return T.updateDOM({state:e,legalTargets:t}),e}T.registerDrag({handleMove:re,updateUI:(e,t)=>{k(u.updatedGrid([new f(e,t,h)]),u.getLegalTargets(e,t))}});T.registerShare(()=>{navigator.clipboard.writeText(M.share).then(()=>{Se("URL with game-state copied to clipboard! 🎆🎆🎆")}).catch(console.error)});T.registerReset($e);T.registerHover((e,t)=>k(u,u.getLegalTargets(e,t)));T.registerUndo(()=>{u=I(A.dec()),M.serialized=u.serialize()},()=>{u=I(A.inc()),M.serialized=u.serialize()});T.registerAi(e=>{e&&Te(u,re,L.depth)});
//# sourceMappingURL=index--cLsPNs9.js.map
