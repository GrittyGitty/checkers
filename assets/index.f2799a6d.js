var Se=Object.defineProperty;var Fe=(n,e,t)=>e in n?Se(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var I=(n,e,t)=>(Fe(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();var B=(n=>(n.black="black",n.red="red",n))(B||{});const x=["black","black-king","red","red-king","empty"],ie=[[-1],[-1,1],[1],[-1,1]],Ie=ie.map(n=>n.map(e=>e*2)),G=[B.black,B.red],y=x.length-1,Ue=(n,...e)=>{const t=Object.entries(n).filter(([,r])=>Boolean(r)).map(([r])=>r);return[...e,...t].join(" ")},Y={turn:B.black,grid:`
-r-r-r-r
r-r-r-r-
-r-r-r-r
--------
--------
b-b-b-b-
-b-b-b-b
b-b-b-b-
`.trim().split(`
`).filter(Boolean).join(`
`)};class w{constructor(e,t,r=y){I(this,"indices");I(this,"value");this.indices={row:e,column:t},this.value=r}static updateFactory(e,t,...r){let o=[];return o.push(new w(e.finalRow,e.finalColumn,t)),r.forEach(({indices:s})=>o.push(new w(s.row,s.column))),o}}function ce(n){for(let e=0;e<8;e++)for(let t=0;t<8;t++)n(e,t)}const U=(()=>{const n=i=>document.getElementById(i),e=n("table"),t=n("turnDiv"),r=n("trailingDiv"),o=n("containerBoard"),s=n("reset"),a=n("share"),d=n("undo"),u=n("redo"),g=i=>(c,l)=>c.addEventListener(i,l),b=g("click"),f=g("mousedown"),v=g("mouseover"),T=g("touchstart"),he="legal-target",q="can-move",X=x.map((i,c)=>`piece-${x[c]}`),pe=X[y],fe=Object.fromEntries(G.map(i=>[i,`piece-${i}`])),K=(i,c)=>e.rows[i].cells[c],Q=i=>{const c=new Set(i.map(({row:l,column:p})=>`${l},${p}`));return(l,p)=>c.has(`${l},${p}`)};let j=!1;const W=i=>ce((c,l)=>i({row:c,column:l,domCell:K(c,l)})),me=(i,{legalTargets:c,piecesThatCanMove:l,turn:p})=>{t.className=fe[p],d.disabled=k===0,u.disabled=k===D.length-1;const E=Q(c),M=Q(l);W(({row:L,column:C,domCell:P})=>{const N=i[L][C],$=Ue({[he]:E(L,C),[q]:M(L,C)&&!j},X[N]);P.className!==$&&(P.className=$)})};f(e,i=>{Z(i,{moveEvent:"mousemove",endEvent:"mouseup",coordsExtractor:c=>c})}),T(e,i=>{Z(i,{moveEvent:"touchmove",endEvent:"touchend",coordsExtractor:c=>c.changedTouches[0]})});function Z(i,{moveEvent:c,endEvent:l,coordsExtractor:p}){const{clientX:E,clientY:M}=p(i);let{row:L,column:C}=ne({clientX:E,clientY:M});const P=new Set(Array.from(K(L,C).classList)),N=P.has.bind(P);if(!N(q)||N(pe))return;j=!0,o.addEventListener(c,se),o.addEventListener(l,Me,{once:!0});const $=X.find(N);$&&(r.className=$);const{width:be,height:Te}=r.getBoundingClientRect(),we=h.getLegalTargets(L,C);h.updatedGrid([new w(L,C,y)]).updateUI(we);const re=(S,F)=>r.style.transform=`translateX(${S}px) translateY(${F}px)`,{x:ye,y:Le}=te({clientX:E,clientY:M}),Ce=ye%be,Ee=Le%Te,oe=({clientX:S,clientY:F})=>re(S-Ce,F-Ee);oe({clientX:E,clientY:M});function se(S){const{clientX:F,clientY:V}=p(S);oe({clientX:F,clientY:V})}function Me(S){o.removeEventListener(c,se),r.style.backgroundImage="",re(-1e3,-1e3),j=!1;let{row:F,column:V}=ne(p(S));m.handleMove(F,V,L,C)}}let{left:_,top:ee,width:z,height:H}=e.getBoundingClientRect();function te({clientX:i,clientY:c}){const l=_+window.pageXOffset,p=ee+window.pageYOffset,E=i-l,M=c-p;return{x:E,y:M}}function ne({clientX:i,clientY:c}){const{x:l,y:p}=te({clientX:i,clientY:c});return l>z||p>H?{row:-1,column:-1}:{row:Math.floor(p/H*8),column:Math.floor(l/z*8)}}function ve(i,c=2e3){const l=document.createElement("div");l.classList.add("toast"),l.innerText=i,document.body.appendChild(l),setTimeout(()=>{document.body.removeChild(l)},c)}return window.onresize=()=>({left:_,top:ee,width:z,height:H}=e.getBoundingClientRect()),{updateUI({grid:i,turn:c,legalTargets:l,piecesThatCanMove:p}){me(i,{legalTargets:l,piecesThatCanMove:p,turn:c})},registerShare:i=>b(a,i),registerUndo:(i,c)=>{b(d,i),b(u,c),window.addEventListener("keydown",({key:l})=>{l==="ArrowLeft"&&!d.disabled&&i(),l==="ArrowRight"&&!u.disabled&&c()})},registerReset:i=>b(s,i),registerHover(i){W(({domCell:c,row:l,column:p})=>{v(c,()=>i(l,p))})},toast:ve}})();class m{constructor(e,t,{flaggedCell:r}={}){I(this,"grid");I(this,"currentTurn");I(this,"flaggedCell");I(this,"piecesThatCanMove");this.grid=e,this.currentTurn=t,this.flaggedCell=r,this.piecesThatCanMove=this.getPiecesThatCanMove()}updatedGrid(e){let t=m.computeGrid(this.grid,e);return new m(t,this.currentTurn)}updateFlaggedCell(e){return new m(this.grid,this.currentTurn,{flaggedCell:e})}updateCurrentTurn(){let e=this.grid;return new m(e,m.oppositeColor(this.currentTurn))}getPiecesThatCanMove(){return J(this.grid,this.currentTurn).filter(({row:e,column:t})=>this.getLegalTargets(e,t).length)}updateUI(e=[]){return U.updateUI({grid:this.grid,turn:this.currentTurn,legalTargets:e,piecesThatCanMove:this.piecesThatCanMove}),this}getLegalTargets(e,t){return ae(this,{startRow:e,startColumn:t}).map(({finalCell:r})=>r)}static oppositeColor(e){return e===G[0]?G[1]:G[0]}static computeGrid(e,t){let r=Ae(e);return t.forEach(({indices:{row:o,column:s},value:a})=>{r[o][s]=a}),r}static handleMove(e,t,r,o){if(h.grid[e][t]!==y||e===-1&&t===-1){h.updateUI();return}let a=Oe(h,{finalRow:e,finalColumn:t,startRow:r,startColumn:o});if(a.length>0){let u=h.updatedGrid(a),g=a.length===3&&x[a[a.length-1].value].split("-")[1]!=="king"||a.length===4,b=R(u.grid,e,t).length!==0;h=g&&b?u.updateFlaggedCell({row:e,column:t}):u.updateFlaggedCell().updateCurrentTurn(),xe(h.grid,h.currentTurn)&&(U.toast(`${h.currentTurn} lost! :(`,5e3),ge())}h.updateUI();const d=h.serialize();O.state=d,D[++k]=d,D.splice(k+1)}static startSession({grid:e,turn:t}){const r=De(e).trim().split(`
`).map(a=>a.trim()),s=Array.from({length:8},()=>Array.from({length:8})).map((a,d)=>a.map((u,g)=>Number(r[d].charAt(g))));return new m(s,t).updateUI()}serialize(){const e=["b","B","r","R","-"];return{grid:this.grid.map(t=>t.map(r=>e[r]).join("")).join(`
`),turn:this.currentTurn}}}function Oe(n,{finalRow:e,finalColumn:t,startRow:r,startColumn:o}){const a=ae(n,{startRow:r,startColumn:o}).find(({finalCell:u})=>u.row===e&&u.column===t);if(!a)return[];const{updates:d}=a;return(e===7||e===0)&&d.length>0&&d.push(new w(e,t,x.indexOf(A(n.grid[r][o])+"-king"))),d}function ae({grid:n,flaggedCell:e,currentTurn:t},{startRow:r,startColumn:o}){const s=n[r][o];return s===y||A(s)!==t||r===(e==null?void 0:e.row)&&o===(e==null?void 0:e.column)?[]:ke(n,A(n[r][o]))?R(n,r,o):le(n,r,o)}function ke(n,e){return J(n,e).some(({row:t,column:r})=>R(n,t,r).length>0)}function A(n){return n!==y?x[n].split("-")[0]:void 0}function R(n,e,t){const r=[2,-2],o=[],s=n[e][t];if(s===y)return o;for(let a of Ie[s])for(let d of r){let u=e+a,g=t+d;if(ue(u)||de(g))continue;let b=n[u][g],f=e+(Math.abs(a)-1)*Math.sign(a),v=t+(Math.abs(d)-1)*Math.sign(d),T=n[f][v];b===y&&A(T)===m.oppositeColor(A(s))&&o.push({finalCell:{row:u,column:g},updates:w.updateFactory({finalRow:u,finalColumn:g},s,new w(f,v),new w(e,t))})}return o}function le(n,e,t){const r=[1,-1];let o=[],s=n[e][t];if(s===y)return o;for(let a of ie[s])for(let d of r){let u=e+a,g=t+d;if(ue(u)||de(g))continue;n[u][g]===y&&o.push({finalCell:{row:u,column:g},updates:w.updateFactory({finalRow:u,finalColumn:g},s,new w(e,t))})}return o}function J(n,e){const t=[];return ce((r,o)=>{A(n[r][o])===e&&t.push({row:r,column:o})}),t}function xe(n,e){return!J(n,e).some(({row:t,column:r})=>R(n,t,r).length>0||le(n,t,r).length>0)}const Ae=n=>n.map(e=>e.map(t=>t));function ue(...n){return n.some(e=>e>=8||e<0)}function de(...n){return n.some(e=>e>=8||e<0)}function De(n){return["b","B","r","R","-"].reduce((e,t,r)=>e.replaceAll(t,String(r)),n)}const Pe=(()=>{const n="state",e="grid",t="turn",{pathname:r,href:o}=window.location,s=()=>{try{return JSON.parse(localStorage.getItem(n))}catch{return}},a=()=>{const f=new URLSearchParams(window.location.search),v=f.get(e),T=f.get(t);return v?{grid:v,turn:T}:void 0},d=()=>(window.location.search?a():s())||Y,u=({grid:f,turn:v}=Y)=>{const T=new URLSearchParams;T.set(e,f),T.set(t,v),history.pushState(null,"",`${r}?${T.toString()}`),localStorage.setItem(n,JSON.stringify({grid:f,turn:v}))},g=()=>{history.pushState(null,"",r),localStorage.removeItem(n)};function b(){const f=new URLSearchParams,{grid:v,turn:T}=d();return f.set(e,v),f.set(t,T),`${o.split("?")[0]}?${f.toString()}`}return{fetch:d,persist:u,reset:g,compileSharingUrl:b}})(),O=(()=>{const{fetch:n,persist:e,reset:t,compileSharingUrl:r}=Pe;return{get state(){return n()},set state({grid:o,turn:s}){e({grid:o,turn:s})},reset:t,get share(){return r()}}})();function ge(){h=m.startSession(Y),D=[Y],k=0,O.reset()}U.registerShare(()=>{navigator.clipboard.writeText(O.share).then(()=>{U.toast("URL with game-state copied to clipboard! \u{1F386}\u{1F386}\u{1F386}")})});U.registerReset(ge);U.registerHover((n,e)=>h.updateUI(h.getLegalTargets(n,e)));U.registerUndo(()=>{h=m.startSession(D[--k]),O.state=h.serialize()},()=>{h=m.startSession(D[++k]),O.state=h.serialize()});let D=[O.state],k=0,h=m.startSession(O.state);
//# sourceMappingURL=index.f2799a6d.js.map
