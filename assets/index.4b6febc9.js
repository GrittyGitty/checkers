var Ce=Object.defineProperty;var Se=(t,e,n)=>e in t?Ce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var v=(t,e,n)=>(Se(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var P=(t=>(t.black="black",t.red="red",t))(P||{});const T=["black","black-king","red","red-king","empty"],ne=[[-1],[-1,1],[1],[-1,1]],Fe=ne.map(t=>t.map(e=>e*2)),A=[P.black,P.red],g=T.length-1;class d{constructor(e,n,r=g){v(this,"indices");v(this,"value");this.indices={row:e,column:n},this.value=r}static updateFactory(e,n,...r){let o=[];return o.push(new d(e.finalRow,e.finalColumn,n)),r.forEach(({indices:s})=>o.push(new d(s.row,s.column))),o}}const $e=(t,...e)=>{const n=Object.entries(t).filter(([,r])=>Boolean(r)).map(([r])=>r);return[...e,...n].join(" ")};function re(t){for(let e=0;e<8;e++)for(let n=0;n<8;n++)t(e,n)}function L(t){return t!==g?T[t].split("-")[0]:void 0}function ke(t){return["b","B","r","R","-"].reduce((e,n,r)=>e.replaceAll(n,String(r)),t)}function oe(t){return t===A[0]?A[1]:A[0]}function Oe(t,{finalRow:e,finalColumn:n,startRow:r,startColumn:o}){const i=se(t,{startRow:r,startColumn:o}).find(({finalCell:a})=>a.row===e&&a.column===n);if(!i)return[];const{updates:c}=i;return(e===7||e===0)&&c.length>0&&c.push(new d(e,n,T.indexOf(L(t.grid[r][o])+"-king"))),c}function se({grid:t,flaggedCell:e,turn:n},{startRow:r,startColumn:o}){const s=t[r][o];return s===g||L(s)!==n||r===(e==null?void 0:e.row)&&o===(e==null?void 0:e.column)?[]:De(t,L(t[r][o]))?I(t,r,o):ae(t,r,o)}function De(t,e){return J(t,e).some(({row:n,column:r})=>I(t,n,r).length>0)}function I(t,e,n){const r=[2,-2],o=[],s=t[e][n];if(s===g)return o;for(let i of Fe[s])for(let c of r){let a=e+i,u=n+c;if(ie(a)||ce(u))continue;let h=t[a][u],$=e+(Math.abs(i)-1)*Math.sign(i),k=n+(Math.abs(c)-1)*Math.sign(c),O=t[$][k];h===g&&L(O)===oe(L(s))&&o.push({finalCell:{row:a,column:u},updates:d.updateFactory({finalRow:a,finalColumn:u},s,new d($,k),new d(e,n))})}return o}function J(t,e){const n=[];return re((r,o)=>{L(t[r][o])===e&&n.push({row:r,column:o})}),n}function xe(t,e){return!J(t,e).some(({row:n,column:r})=>I(t,n,r).length>0||ae(t,n,r).length>0)}const Ae=t=>t.map(e=>e.map(n=>n));function ie(...t){return t.some(e=>e>=8||e<0)}function ce(...t){return t.some(e=>e>=8||e<0)}function ae(t,e,n){const r=[1,-1];let o=[],s=t[e][n];if(s===g)return o;for(let i of ne[s])for(let c of r){let a=e+i,u=n+c;if(ie(a)||ce(u))continue;t[a][u]===g&&o.push({finalCell:{row:a,column:u},updates:d.updateFactory({finalRow:a,finalColumn:u},s,new d(e,n))})}return o}class E{constructor(e,n,{flaggedCell:r}={}){v(this,"grid");v(this,"turn");v(this,"flaggedCell");v(this,"piecesThatCanMove");this.grid=e,this.turn=n,this.flaggedCell=r,this.piecesThatCanMove=this.getPiecesThatCanMove()}updatedGrid(e){let n=E.computeGrid(this.grid,e);return new E(n,this.turn)}updateFlaggedCell(e){return new E(this.grid,this.turn,{flaggedCell:e})}updateCurrentTurn(){let e=this.grid;return new E(e,oe(this.turn))}getPiecesThatCanMove(){return J(this.grid,this.turn).filter(({row:e,column:n})=>this.getLegalTargets(e,n).length)}getLegalTargets(e,n){return se(this,{startRow:e,startColumn:n}).map(({finalCell:r})=>r)}static computeGrid(e,n){let r=Ae(e);return n.forEach(({indices:{row:o,column:s},value:i})=>{r[o][s]=i}),r}serialize(){const e=["b","B","r","R","-"];return{grid:this.grid.map(n=>n.map(r=>e[r]).join("")).join(`
`),turn:this.turn}}}const N={turn:P.black,grid:`
-r-r-r-r
r-r-r-r-
-r-r-r-r
--------
--------
b-b-b-b-
-b-b-b-b
b-b-b-b-
`.trim().split(`
`).filter(Boolean).join(`
`)},q="state",K="grid",_="turn",{pathname:le,href:Pe}=window.location,Be=()=>{try{return JSON.parse(localStorage.getItem(q))}catch{return}},Ie=()=>{const t=new URLSearchParams(window.location.search),e=t.get(K),n=t.get(_);return e?{grid:e,turn:n}:void 0},ue=()=>(window.location.search?Ie():Be())||N,Ne=({grid:t,turn:e}=N)=>{const n=new URLSearchParams;n.set(K,t),n.set(_,e),history.pushState(null,"",`${le}?${n.toString()}`),localStorage.setItem(q,JSON.stringify({grid:t,turn:e}))},Ue=()=>{history.pushState(null,"",le),localStorage.removeItem(q)};function ze(){const t=new URLSearchParams,{grid:e,turn:n}=ue();return t.set(K,e),t.set(_,n),`${Pe.split("?")[0]}?${t.toString()}`}const Ge={fetch:ue,persist:Ne,reset:Ue,compileSharingUrl:ze},{fetch:Ye,persist:Xe,reset:Re,compileSharingUrl:je}=Ge,w={get serialized(){return Ye()},set serialized({grid:t,turn:e}){Xe({grid:t,turn:e})},reset:Re,get share(){return je()}};let y=[w.serialized],b=0;const M={resetStack:()=>{y=[N],b=0},add:t=>{y[++b]=t,y.splice(b+1)},dec:()=>y[--b],inc:()=>y[++b],get isEmpty(){return b===0},get isEnd(){return b===y.length-1}},f=t=>document.getElementById(t),F=f("table"),He=f("turnDiv"),D=f("trailingDiv"),G=f("containerBoard"),Ve=f("reset"),Je=f("share"),Y=f("undo"),X=f("redo"),U=t=>(e,n)=>e.addEventListener(t,n),x=U("click"),qe=U("mousedown"),Ke=U("mouseover"),_e=U("touchstart"),Qe="legal-target",de="can-move",Q=T.map((t,e)=>`piece-${T[e]}`),We=Q[g],Ze=Object.fromEntries(A.map(t=>[t,`piece-${t}`])),ge=(t,e)=>F.rows[t].cells[e],ee=t=>{const e=new Set(t.map(({row:n,column:r})=>`${n},${r}`));return(n,r)=>e.has(`${n},${r}`)};let R=!1,j;const he=t=>re((e,n)=>t({row:e,column:n,domCell:ge(e,n)})),et=(t,{legalTargets:e,piecesThatCanMove:n,turn:r})=>{He.className=Ze[r],Y.disabled=M.isEmpty,X.disabled=M.isEnd;const o=ee(e),s=ee(n);he(({row:i,column:c,domCell:a})=>{const u=t[i][c],h=$e({[Qe]:o(i,c),[de]:s(i,c)&&!R},Q[u]);a.className!==h&&(a.className=h)})};qe(F,t=>{fe(t,{moveEvent:"mousemove",endEvent:"mouseup",coordsExtractor:e=>e})});_e(F,t=>{fe(t,{moveEvent:"touchmove",endEvent:"touchend",coordsExtractor:e=>e.changedTouches[0]})});function fe(t,{moveEvent:e,endEvent:n,coordsExtractor:r}){const{clientX:o,clientY:s}=r(t);let{row:i,column:c}=te({clientX:o,clientY:s});const a=new Set(Array.from(ge(i,c).classList)),u=a.has.bind(a);if(!u(de)||u(We))return;R=!0,G.addEventListener(e,Z),G.addEventListener(n,Me,{once:!0});const h=Q.find(u);h&&(D.className=h);const{width:$,height:k}=D.getBoundingClientRect();j.updateUI(i,c);const O=(p,m)=>D.style.transform=`translateX(${p}px) translateY(${m}px)`,{x:ye,y:Ee}=ve({clientX:o,clientY:s}),Te=ye%$,Le=Ee%k,W=({clientX:p,clientY:m})=>O(p-Te,m-Le);W({clientX:o,clientY:s});function Z(p){const{clientX:m,clientY:z}=r(p);W({clientX:m,clientY:z})}function Me(p){G.removeEventListener(e,Z),D.style.backgroundImage="",O(-1e3,-1e3),R=!1;let{row:m,column:z}=te(r(p));j.handleMove(m,z,i,c)}}let{left:pe,top:me,width:H,height:V}=F.getBoundingClientRect();window.onresize=()=>({left:pe,top:me,width:H,height:V}=F.getBoundingClientRect());function ve({clientX:t,clientY:e}){const n=pe+window.pageXOffset,r=me+window.pageYOffset,o=t-n,s=e-r;return{x:o,y:s}}function te({clientX:t,clientY:e}){const{x:n,y:r}=ve({clientX:t,clientY:e});return n>H||r>V?{row:-1,column:-1}:{row:Math.floor(r/V*8),column:Math.floor(n/H*8)}}const C={updateDOM({grid:t,turn:e,legalTargets:n,piecesThatCanMove:r}){et(t,{legalTargets:n,piecesThatCanMove:r,turn:e})},registerShare:t=>x(Je,t),registerUndo:(t,e)=>{x(Y,t),x(X,e),window.addEventListener("keydown",({key:n})=>{n==="ArrowLeft"&&!Y.disabled&&t(),n==="ArrowRight"&&!X.disabled&&e()})},registerReset:t=>x(Ve,t),registerHover(t){he(({domCell:e,row:n,column:r})=>{Ke(e,()=>t(n,r))})},registerStateControllers(t){j=t}};function be(t,e=2e3){const n=document.createElement("div");n.classList.add("toast"),n.innerText=t,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},e)}function tt(t,e,n,r){if(l.grid[t][e]!==g||t===-1&&e===-1){S(l);return}let s=Oe(l,{finalRow:t,finalColumn:e,startRow:n,startColumn:r});if(s.length>0){let c=l.updatedGrid(s),a=s.length===3&&T[s[s.length-1].value].split("-")[1]!=="king"||s.length===4,u=I(c.grid,t,e).length!==0;l=a&&u?c.updateFlaggedCell({row:t,column:e}):c.updateFlaggedCell().updateCurrentTurn(),xe(l.grid,l.turn)&&(be(`${l.turn} lost! :(`,5e3),we())}S(l);const i=l.serialize();w.serialized=i,M.add(i)}function B({grid:t,turn:e}){const n=ke(t).trim().split(`
`).map(s=>s.trim()),o=Array.from({length:8},()=>Array.from({length:8})).map((s,i)=>s.map((c,a)=>Number(n[i].charAt(a))));return S(new E(o,e))}let l=B(w.serialized);function we(){M.resetStack(),w.reset(),l=B(N)}function S(t,e=[]){return C.updateDOM({grid:t.grid,turn:t.turn,legalTargets:e,piecesThatCanMove:t.piecesThatCanMove}),t}C.registerStateControllers({handleMove:tt,updateUI:(t,e)=>{S(l.updatedGrid([new d(t,e,g)]),l.getLegalTargets(t,e))}});C.registerShare(()=>{navigator.clipboard.writeText(w.share).then(()=>{be("URL with game-state copied to clipboard! \u{1F386}\u{1F386}\u{1F386}")})});C.registerReset(we);C.registerHover((t,e)=>S(l,l.getLegalTargets(t,e)));C.registerUndo(()=>{l=B(M.dec()),w.serialized=l.serialize()},()=>{l=B(M.inc()),w.serialized=l.serialize()});
//# sourceMappingURL=index.4b6febc9.js.map
