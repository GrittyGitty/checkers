var De=Object.defineProperty;var Ae=(t,e,n)=>e in t?De(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var v=(t,e,n)=>(Ae(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var A=(t=>(t.black="black",t.red="red",t))(A||{});const C=["black","black-king","red","red-king","empty"],ie=[[-1],[-1,1],[1],[-1,1]],Fe=ie.map(t=>t.map(e=>e*2)),P=[A.black,A.red],f=C.length-1,Oe=A.red;class g{constructor(e,n,r=f){v(this,"indices");v(this,"value");this.indices={row:e,column:n},this.value=r}static updateFactory(e,n,...r){const o=[];return o.push(new g(e.finalRow,e.finalColumn,n)),r.forEach(({indices:s})=>o.push(new g(s.row,s.column))),o}}function q(t){for(let e=0;e<8;e++)for(let n=0;n<8;n++)t(e,n)}const b=C.map((t,e)=>e!==f?C[e].split("-")[0]:void 0);function xe(t){return["b","B","r","R","-"].reduce((e,n,r)=>e.replaceAll(n,String(r)),t)}function ce(t){return t===P[0]?P[1]:P[0]}const k={turn:A.black,grid:`
-r-r-r-r
r-r-r-r-
-r-r-r-r
--------
--------
b-b-b-b-
-b-b-b-b
b-b-b-b-
`.trim().split(`
`).filter(Boolean).join(`
`)},Pe=t=>{const e=xe(t).trim().split(`
`).map(r=>r.trim());return Array.from({length:8},()=>Array.from({length:8})).map((r,o)=>r.map((s,i)=>Number(e[o].charAt(i))))};function Re(t,{finalRow:e,finalColumn:n,startRow:r,startColumn:o}){const i=H(t,{startRow:r,startColumn:o}).find(({finalCell:a})=>a.row===e&&a.column===n);if(i==null)return[];const{updates:c}=i;return(e===7||e===0)&&c.length>0&&c.push(new g(e,n,C.indexOf(`${b[t.grid[r][o]]}-king`))),c}function H({grid:t,turn:e},{startRow:n,startColumn:r}){const o=t[n][r];return o===f||b[o]!==e?[]:Ge(t,b[t[n][r]])?B(t,n,r):ue(t,n,r)}function Ge(t,e){return G(t,e).some(({row:n,column:r})=>B(t,n,r).length>0)}function B(t,e,n){const r=[2,-2],o=[],s=t[e][n];if(s===f)return o;for(const i of Fe[s])for(const c of r){const a=e+i,u=n+c;if(ae(a)||le(u))continue;const y=t[a][u],d=e+(Math.abs(i)-1)*Math.sign(i),$=n+(Math.abs(c)-1)*Math.sign(c),z=t[d][$];y===f&&b[z]===ce(b[s])&&o.push({finalCell:{row:a,column:u},updates:g.updateFactory({finalRow:a,finalColumn:u},s,new g(d,$),new g(e,n))})}return o}function G(t,e){const n=[];return q((r,o)=>{b[t[r][o]]===e&&n.push({row:r,column:o})}),n}function Ne(t,e){return!G(t,e).some(({row:n,column:r})=>B(t,n,r).length>0||ue(t,n,r).length>0)}const Ue=t=>t.map(e=>e.map(n=>n));function ae(...t){return t.some(e=>e>=8||e<0)}function le(...t){return t.some(e=>e>=8||e<0)}function ue(t,e,n){const r=[1,-1],o=[],s=t[e][n];if(s===f)return o;for(const i of ie[s])for(const c of r){const a=e+i,u=n+c;if(ae(a)||le(u))continue;t[a][u]===f&&o.push({finalCell:{row:a,column:u},updates:g.updateFactory({finalRow:a,finalColumn:u},s,new g(e,n))})}return o}class L{constructor(e,n,{flaggedCell:r}={}){v(this,"grid");v(this,"turn");v(this,"flaggedCell");v(this,"piecesThatCanMove");this.grid=e,this.turn=n,this.flaggedCell=r,this.piecesThatCanMove=this.getPiecesThatCanMove()}updatedGrid(e){const n=L.computeGrid(this.grid,e);return new L(n,this.turn)}updateFlaggedCell(e){return new L(this.grid,this.turn,{flaggedCell:e})}updateCurrentTurn(){const e=this.grid;return new L(e,ce(this.turn))}getAllLegalMovesForColor(){return G(this.grid,this.turn).map(e=>[e,H(this,{startRow:e.row,startColumn:e.column})])}getPiecesThatCanMove(){return(this.flaggedCell!=null?[this.flaggedCell]:G(this.grid,this.turn)).filter(({row:e,column:n})=>this.getLegalTargets(e,n).length)}getLegalTargets(e,n){return H(this,{startRow:e,startColumn:n}).map(({finalCell:r})=>r)}static computeGrid(e,n){const r=Ue(e);return n.forEach(({indices:{row:o,column:s},value:i})=>{r[o][s]=i}),r}serialize(){const e=["b","B","r","R","-"];return{grid:this.grid.map(n=>n.map(r=>e[r]).join("")).join(`
`),turn:this.turn}}}const K="state",Q="grid",W="turn",{pathname:de,href:ke}=window.location,Be=()=>{try{const t=localStorage.getItem(K);if(!t)throw new Error("State Not Found");return JSON.parse(t)}catch{}},Ie=()=>{const t=new URLSearchParams(window.location.search),e=t.get(Q),n=t.get(W);return e?{grid:e,turn:n}:void 0},ge=()=>(window.location.search?Ie():Be())||k,ze=({grid:t,turn:e}=k)=>{const n=new URLSearchParams;n.set(Q,t),n.set(W,e),history.pushState(null,"",`${de}?${n.toString()}`),localStorage.setItem(K,JSON.stringify({grid:t,turn:e}))},Ye=()=>{history.pushState(null,"",de),localStorage.removeItem(K)};function Xe(){const t=new URLSearchParams,{grid:e,turn:n}=ge();return t.set(Q,e),t.set(W,n),`${ke.split("?")[0]}?${t.toString()}`}const He={fetch:ge,persist:ze,reset:Ye,compileSharingUrl:Xe},{fetch:je,persist:Ve,reset:_e,compileSharingUrl:Je}=He,M={get serialized(){return je()},set serialized({grid:t,turn:e}){Ve({grid:t,turn:e})},reset:_e,get share(){return Je()}};let E=[M.serialized],w=0;const S={resetStack:()=>{E=[k],w=0},add:t=>{E[++w]=t,E.splice(w+1)},dec:()=>E[--w],inc:()=>E[++w],get isEmpty(){return w===0},get isEnd(){return w===E.length-1}},p=t=>{const e=document.getElementById(t);if(e==null)throw new Error(`${t} element does not exist`);return e},F=p("table"),qe=p("turnDiv"),x=p("trailingDiv"),X=p("containerBoard"),Ke=p("reset"),Qe=p("share"),j=p("undo"),V=p("redo"),We=p("ai"),I=t=>(e,n)=>{e.addEventListener(t,n)},D=I("click"),Ze=I("mousedown"),et=I("mouseover"),tt=I("touchstart"),nt="legal-target",fe="can-move",Z=C.map((t,e)=>`piece-${C[e]}`),rt=Z[f],ot=Object.fromEntries(P.map(t=>[t,`piece-${t}`])),pe=(t,e)=>F.rows[t].cells[e],oe=t=>{const e=new Set(t.map(({row:n,column:r})=>`${n},${r}`));return(n,r)=>e.has(`${n},${r}`)};let N=!1;const he=t=>{q((e,n)=>{t(e,n,pe(e,n))})},st=(t,e,n,r)=>{qe.className=ot[e],j.disabled=S.isEmpty,V.disabled=S.isEnd;const o=oe(n),s=oe(r);he((i,c,a)=>{const u=t[i][c];let d=`${Z[u]} `;o(i,c)&&(d+=`${nt} `),!N&&s(i,c)&&(d+=fe),a.className!==d&&(a.className=d)})},it=t=>{Ze(F,n=>{e(n,{moveEvent:"mousemove",endEvent:"mouseup",coordsExtractor:r=>r})}),tt(F,n=>{e(n,{moveEvent:"touchmove",endEvent:"touchend",coordsExtractor:r=>r.changedTouches[0]})});function e(n,{moveEvent:r,endEvent:o,coordsExtractor:s}){const{clientX:i,clientY:c}=s(n),{row:a,column:u}=se({clientX:i,clientY:c}),y=new Set(Array.from(pe(a,u).classList)),d=y.has.bind(y);if(!d(fe)||d(rt))return;N=!0,X.addEventListener(r,re),X.addEventListener(o,$e,{once:!0});const $=Z.find(d);typeof $=="string"&&(x.className=$);const{width:z,height:Te}=x.getBoundingClientRect();t.updateUI(a,u);const te=(h,m)=>{x.style.transform=`translateX(${h}px) translateY(${m}px)`},{x:ye,y:Ee}=we({clientX:i,clientY:c}),Le=ye%z,Se=Ee%Te,ne=({clientX:h,clientY:m})=>{te(h-Le,m-Se)};ne({clientX:i,clientY:c});function re(h){const{clientX:m,clientY:Y}=s(h);ne({clientX:m,clientY:Y})}function $e(h){X.removeEventListener(r,re),x.style.backgroundImage="",te(-1e3,-1e3),N=!1;const{row:m,column:Y}=se(s(h));t.handleMove(m,Y,a,u)}}};let{left:me,top:ve,width:_,height:J}=F.getBoundingClientRect();window.onresize=()=>({left:me,top:ve,width:_,height:J}=F.getBoundingClientRect());function we({clientX:t,clientY:e}){const n=me+window.pageXOffset,r=ve+window.pageYOffset,o=t-n,s=e-r;return{x:o,y:s}}function se({clientX:t,clientY:e}){const{x:n,y:r}=we({clientX:t,clientY:e});return n>_||r>J?{row:-1,column:-1}:{row:Math.floor(r/J*8),column:Math.floor(n/_*8)}}const T={updateDOM({grid:t,turn:e,legalTargets:n,piecesThatCanMove:r}){st(t,e,n,r)},registerShare:t=>{D(Qe,t)},registerUndo:(t,e)=>{D(j,t),D(V,e),window.addEventListener("keydown",({key:n})=>{n==="ArrowLeft"&&!j.disabled&&t(),n==="ArrowRight"&&!V.disabled&&e()})},registerReset:t=>{D(Ke,t)},registerHover(t){he((e,n,r)=>{et(r,()=>{N||t(e,n)})})},registerDrag(t){it(t)},registerAi(t){D(We,t)}};function Ce(t,e=2e3){const n=document.createElement("div");n.classList.add("toast"),n.innerText=t,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},e)}const ct=[1,1.2,1,1.2,0],at=({grid:t,turn:e})=>{let n=0;return q((r,o)=>{const s=t[r][o],i=b[s];if(!i)return;const c=ct[s];n+=i===e?c:-c}),n},lt=5,ut={score:0,move:{finalColumn:0,finalRow:0,startColumn:0,startRow:0}};function dt(t){function e(r,o=lt){if(!o)return at(r);let s=0;for(const[,i]of r.getAllLegalMovesForColor())for(const{updates:c}of i){const a=e(r.updatedGrid(c).updateCurrentTurn(),o-1);a>=s&&(s=a)}return s}let n=ut;for(const[r,o]of t.getAllLegalMovesForColor())for(const{updates:s,finalCell:i}of o){const c=e(t.updatedGrid(s).updateCurrentTurn());c>=n.score&&(n={score:c,move:{startRow:r.row,startColumn:r.column,finalRow:i.row,finalColumn:i.column}})}return n.move}const be=(t,e)=>{t.turn===Oe&&setTimeout(()=>{const n=performance.now(),{finalRow:r,finalColumn:o,startRow:s,startColumn:i}=dt(t),c=performance.now()-n,a=Math.max(250-c,0);setTimeout(()=>{e(r,o,s,i)},a)},50)};let R=!0;function ee(t,e,n,r){if(l.grid[t][e]!==f||t===-1&&e===-1){O(l);return}const s=Re(l,{finalRow:t,finalColumn:e,startRow:n,startColumn:r});if(s.length>0){const c=l.updatedGrid(s),a=s.length===3&&C[s[s.length-1].value].split("-")[1]!=="king"||s.length===4,u=B(c.grid,t,e).length!==0;l=a&&u?c.updateFlaggedCell({row:t,column:e}):c.updateFlaggedCell().updateCurrentTurn(),Ne(l.grid,l.turn)&&(Ce(`${l.turn} lost! :(`,5e3),Me())}O(l);const i=l.serialize();M.serialized=i,S.add(i),R&&be(l,ee)}function U({grid:t,turn:e}){const n=Pe(t);return O(new L(n,e))}let l=U(M.serialized);function Me(){S.resetStack(),M.reset(),l=U(k)}function O(t,e=[]){return T.updateDOM({grid:t.grid,turn:t.turn,legalTargets:e,piecesThatCanMove:t.piecesThatCanMove}),t}T.registerDrag({handleMove:ee,updateUI:(t,e)=>{O(l.updatedGrid([new g(t,e,f)]),l.getLegalTargets(t,e))}});T.registerShare(()=>{navigator.clipboard.writeText(M.share).then(()=>{Ce("URL with game-state copied to clipboard! 🎆🎆🎆")}).catch(console.error)});T.registerReset(Me);T.registerHover((t,e)=>O(l,l.getLegalTargets(t,e)));T.registerUndo(()=>{l=U(S.dec()),M.serialized=l.serialize()},()=>{l=U(S.inc()),M.serialized=l.serialize()});T.registerAi(()=>{R=!R,R&&be(l,ee)});
//# sourceMappingURL=index-dde5caad.js.map
