var R=Object.defineProperty;var S=(i,a,g)=>a in i?R(i,a,{enumerable:!0,configurable:!0,writable:!0,value:g}):i[a]=g;var v=(i,a,g)=>(S(i,typeof a!="symbol"?a+"":a,g),g);(function(){"use strict";var i=(n=>(n.black="black",n.red="red",n))(i||{});const a=["black","black-king","red","red-king","empty"],g=[[-1],[-1,1],[1],[-1,1]],O=g.map(n=>n.map(e=>e*2)),w=[i.black,i.red],b=a.length-1;i.red;function y(n){for(let e=0;e<8;e++)for(let t=0;t<8;t++)n(e,t)}const m=a.map((n,e)=>e!==b?a[e].split("-")[0]:void 0);function F(n){return n===w[0]?w[1]:w[0]}i.black,`
-r-r-r-r
r-r-r-r-
-r-r-r-r
--------
--------
b-b-b-b-
-b-b-b-b
b-b-b-b-
`.trim().split(`
`).filter(Boolean).join(`
`);function j(n,e){if(!n)throw new Error(e)}class d{constructor(e,t,o=b){v(this,"indices");v(this,"value");this.indices={row:e,column:t},this.value=o}static updateFactory(e,t,...o){const s=[];s.push(new d(e.finalRow,e.finalColumn,t));for(const{indices:r}of o)s.push(new d(r.row,r.column));return s}}function L({grid:n,turn:e},{startRow:t,startColumn:o}){const s=n[t][o];return s===b||m[s]!==e?[]:z(n,m[n[t][o]])?T(n,t,o):N(n,t,o)}function z(n,e){return E(n,e).some(({row:t,column:o})=>T(n,t,o).length>0)}function T(n,e,t){const o=[2,-2],s=[],r=n[e][t];if(r===b)return s;for(const l of O[r])for(const c of o){const u=e+l,f=t+c;if(G(u)||x(f))continue;const B=n[u][f],P=e+(Math.abs(l)-1)*Math.sign(l),D=t+(Math.abs(c)-1)*Math.sign(c),Q=n[P][D];B===b&&m[Q]===F(m[r])&&s.push({finalCell:{row:u,column:f},updates:d.updateFactory({finalRow:u,finalColumn:f},r,new d(P,D),new d(e,t))})}return s}function E(n,e){const t=[];return y((o,s)=>{m[n[o][s]]===e&&t.push({row:o,column:s})}),t}const K=n=>n.map(e=>e.map(t=>t));function G(...n){return n.some(e=>e>=8||e<0)}function x(...n){return n.some(e=>e>=8||e<0)}function N(n,e,t){const o=[1,-1],s=[],r=n[e][t];if(r===b)return s;for(const l of g[r])for(const c of o){const u=e+l,f=t+c;if(G(u)||x(f))continue;n[u][f]===b&&s.push({finalCell:{row:u,column:f},updates:d.updateFactory({finalRow:u,finalColumn:f},r,new d(e,t))})}return s}class p{constructor({grid:e,turn:t,flaggedCell:o,lastMove:s}){v(this,"grid");v(this,"turn");v(this,"flaggedCell");v(this,"lastMove");this.grid=e,this.turn=t,this.flaggedCell=o,this.lastMove=s}updatedGrid(e){return new p({...this,grid:p.computeGrid(this.grid,e)})}updateFlaggedCell(e){return new p({...this,flaggedCell:e})}updateLastMove(e){return new p({...this,lastMove:e})}updateCurrentTurn(){return new p({...this,grid:this.grid,turn:F(this.turn)})}getAllLegalMovesForColor(){return this.effectivePieces.map(e=>[e,L(this,{startRow:e.row,startColumn:e.column})]).filter(([,e])=>e.length)}get piecesThatCanMove(){return this.effectivePieces.filter(({row:e,column:t})=>this.getLegalTargets(e,t).length)}get effectivePieces(){return this.flaggedCell!=null?[this.flaggedCell]:E(this.grid,this.turn)}getLegalTargets(e,t){return L(this,{startRow:e,startColumn:t}).map(({finalCell:o})=>o)}static computeGrid(e,t){const o=K(e);for(const{indices:{row:s,column:r},value:l}of t)o[s][r]=l;return o}serialize(){const e=["b","B","r","R","-"];return{grid:this.grid.map(t=>t.map(o=>e[o]).join("")).join(`
`),turn:this.turn}}static deserialize(e){return new p(e)}}const C=1.5,M=2,h=4,I=5,k=10,A=I+k,V=[k,A,k,A,0],Y=[[0,h,0,h,0,h,0,h],[C,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,C],[C,0,M,0,M,0,0,0],[0,0,0,M,0,M,0,C],[C,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,C],[h,0,h,0,h,0,h,0]],q=(n,e,t,o)=>{const s=Y[n][e];return s===C?o===t?s:-s:n<=3&&t===i.red?o===i.red?s:-s:n>=4&&t===i.black?o===i.black?s:-s:0},H=({grid:n,turn:e})=>{let t=0;return y((o,s)=>{const r=n[o][s],l=m[r];if(!l)return;const c=V[r],u=q(o,s,l,e);t+=(l===e?c:-c)+u}),t};function J(n,e){let t=0;const o=[{state:n,depth:e}];let s;for(;o.length>0;){s=o.pop(),j(s);const{state:r,depth:l}=s;if(!l){const c=H(r);c>=t&&(t=c);continue}for(const[,c]of r.getAllLegalMovesForColor())for(const{updates:u}of c)o.push({state:r.updatedGrid(u).updateCurrentTurn(),depth:l-1})}return t}self.addEventListener("message",({data:n})=>{const e=p.deserialize(n.state),t=String(e.grid),s={score:J(e,n.depth),stringGrid:t};postMessage(s)})})();
//# sourceMappingURL=worker-7v_Ge4FE.js.map
