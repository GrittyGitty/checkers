var De=Object.defineProperty;var Fe=(t,e,n)=>e in t?De(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(Fe(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var D=(t=>(t.black="black",t.red="red",t))(D||{});const b=["black","black-king","red","red-king","empty"],ae=[[-1],[-1,1],[1],[-1,1]],Pe=ae.map(t=>t.map(e=>e*2)),x=[D.black,D.red],f=b.length-1,Re=D.red;class g{constructor(e,n,r=f){m(this,"indices");m(this,"value");this.indices={row:e,column:n},this.value=r}static updateFactory(e,n,...r){const o=[];return o.push(new g(e.finalRow,e.finalColumn,n)),r.forEach(({indices:s})=>o.push(new g(s.row,s.column))),o}}function le(t){for(let e=0;e<8;e++)for(let n=0;n<8;n++)t(e,n)}const S=b.map((t,e)=>e!==f?b[e].split("-")[0]:void 0);function ke(t){return["b","B","r","R","-"].reduce((e,n,r)=>e.replaceAll(n,String(r)),t)}function ue(t){return t===x[0]?x[1]:x[0]}const z={turn:D.black,grid:`
-r-r-r-r
r-r-r-r-
-r-r-r-r
--------
--------
b-b-b-b-
-b-b-b-b
b-b-b-b-
`.trim().split(`
`).filter(Boolean).join(`
`)},xe=t=>{const e=ke(t).trim().split(`
`).map(r=>r.trim());return Array.from({length:8},()=>Array.from({length:8})).map((r,o)=>r.map((s,i)=>Number(e[o].charAt(i))))};function Ne(t,{finalRow:e,finalColumn:n,startRow:r,startColumn:o}){const i=q(t,{startRow:r,startColumn:o}).find(({finalCell:c})=>c.row===e&&c.column===n);if(i==null)return[];const{updates:a}=i;return(e===7||e===0)&&a.length>0&&a.push(new g(e,n,b.indexOf(`${S[t.grid[r][o]]}-king`))),a}function q({grid:t,turn:e},{startRow:n,startColumn:r}){const o=t[n][r];return o===f||S[o]!==e?[]:Ue(t,S[t[n][r]])?B(t,n,r):fe(t,n,r)}function Ue(t,e){return U(t,e).some(({row:n,column:r})=>B(t,n,r).length>0)}function B(t,e,n){const r=[2,-2],o=[],s=t[e][n];if(s===f)return o;for(const i of Pe[s])for(const a of r){const c=e+i,u=n+a;if(de(c)||ge(u))continue;const h=t[c][u],w=e+(Math.abs(i)-1)*Math.sign(i),d=n+(Math.abs(a)-1)*Math.sign(a),O=t[w][d];h===f&&S[O]===ue(S[s])&&o.push({finalCell:{row:c,column:u},updates:g.updateFactory({finalRow:c,finalColumn:u},s,new g(w,d),new g(e,n))})}return o}function U(t,e){const n=[];return le((r,o)=>{S[t[r][o]]===e&&n.push({row:r,column:o})}),n}function Ie(t,e){return!U(t,e).some(({row:n,column:r})=>B(t,n,r).length>0||fe(t,n,r).length>0)}const Ge=t=>t.map(e=>e.map(n=>n));function de(...t){return t.some(e=>e>=8||e<0)}function ge(...t){return t.some(e=>e>=8||e<0)}function fe(t,e,n){const r=[1,-1],o=[],s=t[e][n];if(s===f)return o;for(const i of ae[s])for(const a of r){const c=e+i,u=n+a;if(de(c)||ge(u))continue;t[c][u]===f&&o.push({finalCell:{row:c,column:u},updates:g.updateFactory({finalRow:c,finalColumn:u},s,new g(e,n))})}return o}class v{constructor({grid:e,turn:n,flaggedCell:r,lastMove:o}){m(this,"grid");m(this,"turn");m(this,"flaggedCell");m(this,"piecesThatCanMove");m(this,"lastMove");this.grid=e,this.turn=n,this.flaggedCell=r,this.lastMove=o,this.piecesThatCanMove=this.getPiecesThatCanMove()}updatedGrid(e){return new v({...this,grid:v.computeGrid(this.grid,e)})}updateFlaggedCell(e){return new v({...this,flaggedCell:e})}updateLastMove(e){return new v({...this,lastMove:e})}updateCurrentTurn(){return new v({...this,grid:this.grid,turn:ue(this.turn)})}getAllLegalMovesForColor(){return U(this.grid,this.turn).map(e=>[e,q(this,{startRow:e.row,startColumn:e.column})])}getPiecesThatCanMove(){return(this.flaggedCell!=null?[this.flaggedCell]:U(this.grid,this.turn)).filter(({row:e,column:n})=>this.getLegalTargets(e,n).length)}getLegalTargets(e,n){return q(this,{startRow:e,startColumn:n}).map(({finalCell:r})=>r)}static computeGrid(e,n){const r=Ge(e);return n.forEach(({indices:{row:o,column:s},value:i})=>{r[o][s]=i}),r}serialize(){const e=["b","B","r","R","-"];return{grid:this.grid.map(n=>n.map(r=>e[r]).join("")).join(`
`),turn:this.turn}}static deserialize(e){return new v(e)}}const Z="state",ee="grid",te="turn",{pathname:he,href:ze}=window.location,Be=()=>{try{const t=localStorage.getItem(Z);if(!t)throw new Error("State Not Found");return JSON.parse(t)}catch{}},Ye=()=>{const t=new URLSearchParams(window.location.search),e=t.get(ee),n=t.get(te);return e?{grid:e,turn:n}:void 0},pe=()=>(window.location.search?Ye():Be())||z,Xe=({grid:t,turn:e}=z)=>{const n=new URLSearchParams;n.set(ee,t),n.set(te,e),history.pushState(null,"",`${he}?${n.toString()}`),localStorage.setItem(Z,JSON.stringify({grid:t,turn:e}))},Ve=()=>{history.pushState(null,"",he),localStorage.removeItem(Z)};function je(){const t=new URLSearchParams,{grid:e,turn:n}=pe();return t.set(ee,e),t.set(te,n),`${ze.split("?")[0]}?${t.toString()}`}const We={fetch:pe,persist:Xe,reset:Ve,compileSharingUrl:je},{fetch:He,persist:qe,reset:Je,compileSharingUrl:Ke}=We,y={get serialized(){return He()},set serialized({grid:t,turn:e}){qe({grid:t,turn:e})},reset:Je,get share(){return Ke()}};let T=[y.serialized],M=0;const $={resetStack:()=>{T=[z],M=0},add:t=>{T[++M]=t,T.splice(M+1)},dec:()=>T[--M],inc:()=>T[++M],get isEmpty(){return M===0},get isEnd(){return M===T.length-1}},p=t=>{const e=document.getElementById(t);if(e==null)throw new Error(`${t} element does not exist`);return e},F=p("table"),_e=p("turnDiv"),k=p("trailingDiv"),W=p("containerBoard"),Qe=p("reset"),Ze=p("share"),J=p("undo"),K=p("redo"),et=p("ai"),Y=t=>(e,n)=>{e.addEventListener(t,n)},A=Y("click"),tt=Y("mousedown"),nt=Y("mouseover"),rt=Y("touchstart"),ot="legal-target",me="can-move",st="move-source",it="move-destination",ne=b.map((t,e)=>`piece-${b[e]}`),ct=ne[f],at=Object.fromEntries(x.map(t=>[t,`piece-${t}`])),ve=(t,e)=>F.rows[t].cells[e],ie=t=>{const e=new Set(t.map(({row:n,column:r})=>`${n},${r}`));return(n,r)=>e.has(`${n},${r}`)};let I=!1;const we=t=>{le((e,n)=>{t(e,n,ve(e,n))})},lt=({grid:t,turn:e,lastMove:n,piecesThatCanMove:r},o)=>{_e.className=at[e],J.disabled=$.isEmpty,K.disabled=$.isEnd;const s=ie(o),i=ie(r);we((a,c,u)=>{const h=t[a][c];let d=`${ne[h]} `;if(n){const{startRow:O,startColumn:X,finalRow:R,finalColumn:V}=n;O===a&&X===c?d+=`${st} `:R===a&&V===c&&(d+=`${it} `)}s(a,c)&&(d+=`${ot} `),!I&&i(a,c)&&(d+=me),u.className!==d&&(u.className=d)})},ut=t=>{tt(F,n=>{e(n,{moveEvent:"mousemove",endEvent:"mouseup",coordsExtractor:r=>r})}),rt(F,n=>{e(n,{moveEvent:"touchmove",endEvent:"touchend",coordsExtractor:r=>r.changedTouches[0]})});function e(n,{moveEvent:r,endEvent:o,coordsExtractor:s}){const{clientX:i,clientY:a}=s(n),{row:c,column:u}=ce({clientX:i,clientY:a}),h=new Set(Array.from(ve(c,u).classList)),w=h.has.bind(h);if(!w(me)||w(ct))return;I=!0,W.addEventListener(r,se),W.addEventListener(o,Ae,{once:!0});const d=ne.find(w);typeof d=="string"&&(k.className=d);const{width:O,height:X}=k.getBoundingClientRect();t.updateUI(c,u);const R=(C,E)=>{k.style.transform=`translateX(${C}px) translateY(${E}px)`},{x:V,y:Se}=Me({clientX:i,clientY:a}),$e=V%O,Oe=Se%X,oe=({clientX:C,clientY:E})=>{R(C-$e,E-Oe)};oe({clientX:i,clientY:a});function se(C){const{clientX:E,clientY:j}=s(C);oe({clientX:E,clientY:j})}function Ae(C){W.removeEventListener(r,se),k.style.backgroundImage="",R(-1e3,-1e3),I=!1;const{row:E,column:j}=ce(s(C));t.handleMove(E,j,c,u)}}};let{left:Ce,top:Ee,width:_,height:Q}=F.getBoundingClientRect();window.onresize=()=>({left:Ce,top:Ee,width:_,height:Q}=F.getBoundingClientRect());function Me({clientX:t,clientY:e}){const n=Ce+window.pageXOffset,r=Ee+window.pageYOffset,o=t-n,s=e-r;return{x:o,y:s}}function ce({clientX:t,clientY:e}){const{x:n,y:r}=Me({clientX:t,clientY:e});return n>_||r>Q?{row:-1,column:-1}:{row:Math.floor(r/Q*8),column:Math.floor(n/_*8)}}const L={updateDOM({state:t,legalTargets:e}){lt(t,e)},registerShare:t=>{A(Ze,t)},registerUndo:(t,e)=>{A(J,t),A(K,e),window.addEventListener("keydown",({key:n})=>{n==="ArrowLeft"&&!J.disabled&&t(),n==="ArrowRight"&&!K.disabled&&e()})},registerReset:t=>{A(Qe,t)},registerHover(t){we((e,n,r)=>{nt(r,()=>{I||t(e,n)})})},registerDrag(t){ut(t)},registerAi(t){A(et,t)}};function be(t,e=2e3){const n=document.createElement("div");n.classList.add("toast"),n.innerText=t,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},e)}function dt(){return new Worker(""+new URL("worker-a7d4a4de.js",import.meta.url).href)}const ye=window.navigator.hardwareConcurrency+2,gt=Array.from({length:ye}).map(()=>new dt);let H=0;const ft=()=>{const t=gt[H];return H=(H+1)%ye,t},ht=t=>new Promise(e=>{const n=ft(),r=String(t.grid);n.addEventListener("message",o),n.postMessage(t);function o({data:{score:s,stringGrid:i}}){r===i&&(e(s),n.removeEventListener("message",o))}}),pt={score:0,move:{finalColumn:0,finalRow:0,startColumn:0,startRow:0}};async function mt(t){return(await Promise.all(t.getAllLegalMovesForColor().flatMap(([{row:n,column:r},o])=>o.map(({updates:s,finalCell:{row:i,column:a}})=>ht(t.updatedGrid(s).updateCurrentTurn()).then(c=>({move:{startRow:n,startColumn:r,finalRow:i,finalColumn:a},score:c})))))).reduce((n,r)=>r.score>=n.score?r:n,pt).move}const Le=(t,e)=>{t.turn===Re&&setTimeout(()=>{const n=performance.now();mt(t).then(({finalRow:r,finalColumn:o,startRow:s,startColumn:i})=>{const a=performance.now()-n;console.log(`Time elapsed: ${a}ms`);const c=Math.max(200-a,0);setTimeout(()=>{e(r,o,s,i)},c)}).catch(console.error)},50)};let N=!0;function re(t,e,n,r){if(l.grid[t][e]!==f||t===-1&&e===-1){P(l);return}const s={finalRow:t,finalColumn:e,startRow:n,startColumn:r},i=Ne(l,s);if(i.length>0){const c=l.updatedGrid(i).updateLastMove(s),u=i.length===3&&b[i[i.length-1].value].split("-")[1]!=="king"||i.length===4,h=B(c.grid,t,e).length!==0;l=u&&h?c.updateFlaggedCell({row:t,column:e}):c.updateFlaggedCell().updateCurrentTurn(),Ie(l.grid,l.turn)&&(be(`${l.turn} lost! :(`,5e3),Te())}P(l);const a=l.serialize();y.serialized=a,$.add(a),N&&Le(l,re)}function G({grid:t,turn:e}){const n=xe(t);return P(new v({grid:n,turn:e}))}let l=G(y.serialized);function Te(){$.resetStack(),y.reset(),l=G(z)}function P(t,e=[]){return L.updateDOM({state:t,legalTargets:e}),t}L.registerDrag({handleMove:re,updateUI:(t,e)=>{P(l.updatedGrid([new g(t,e,f)]),l.getLegalTargets(t,e))}});L.registerShare(()=>{navigator.clipboard.writeText(y.share).then(()=>{be("URL with game-state copied to clipboard! 🎆🎆🎆")}).catch(console.error)});L.registerReset(Te);L.registerHover((t,e)=>P(l,l.getLegalTargets(t,e)));L.registerUndo(()=>{l=G($.dec()),y.serialized=l.serialize()},()=>{l=G($.inc()),y.serialized=l.serialize()});L.registerAi(()=>{N=!N,N&&Le(l,re)});
//# sourceMappingURL=index-e9df1cb0.js.map
