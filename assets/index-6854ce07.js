var Me=Object.defineProperty;var Se=(e,t,n)=>t in e?Me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var v=(e,t,n)=>(Se(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var A=(e=>(e.black="black",e.red="red",e))(A||{});const T=["black","black-king","red","red-king","empty"],ne=[[-1],[-1,1],[1],[-1,1]],$e=ne.map(e=>e.map(t=>t*2)),x=[A.black,A.red],f=T.length-1;class g{constructor(t,n,r=f){v(this,"indices");v(this,"value");this.indices={row:t,column:n},this.value=r}static updateFactory(t,n,...r){const o=[];return o.push(new g(t.finalRow,t.finalColumn,n)),r.forEach(({indices:s})=>o.push(new g(s.row,s.column))),o}}function re(e){for(let t=0;t<8;t++)for(let n=0;n<8;n++)e(t,n)}function L(e){return e!==f?T[e].split("-")[0]:void 0}function De(e){return["b","B","r","R","-"].reduce((t,n,r)=>t.replaceAll(n,String(r)),e)}function oe(e){return e===x[0]?x[1]:x[0]}function Oe(e,{finalRow:t,finalColumn:n,startRow:r,startColumn:o}){const i=se(e,{startRow:r,startColumn:o}).find(({finalCell:c})=>c.row===t&&c.column===n);if(i==null)return[];const{updates:a}=i;return(t===7||t===0)&&a.length>0&&a.push(new g(t,n,T.indexOf(`${L(e.grid[r][o])}-king`))),a}function se({grid:e,turn:t},{startRow:n,startColumn:r}){const o=e[n][r];return o===f||L(o)!==t?[]:Fe(e,L(e[n][r]))?I(e,n,r):ae(e,n,r)}function Fe(e,t){return V(e,t).some(({row:n,column:r})=>I(e,n,r).length>0)}function I(e,t,n){const r=[2,-2],o=[],s=e[t][n];if(s===f)return o;for(const i of $e[s])for(const a of r){const c=t+i,u=n+a;if(ie(c)||ce(u))continue;const y=e[c][u],d=t+(Math.abs(i)-1)*Math.sign(i),$=n+(Math.abs(a)-1)*Math.sign(a),B=e[d][$];y===f&&L(B)===oe(L(s))&&o.push({finalCell:{row:c,column:u},updates:g.updateFactory({finalRow:c,finalColumn:u},s,new g(d,$),new g(t,n))})}return o}function V(e,t){const n=[];return re((r,o)=>{L(e[r][o])===t&&n.push({row:r,column:o})}),n}function Pe(e,t){return!V(e,t).some(({row:n,column:r})=>I(e,n,r).length>0||ae(e,n,r).length>0)}const xe=e=>e.map(t=>t.map(n=>n));function ie(...e){return e.some(t=>t>=8||t<0)}function ce(...e){return e.some(t=>t>=8||t<0)}function ae(e,t,n){const r=[1,-1],o=[],s=e[t][n];if(s===f)return o;for(const i of ne[s])for(const a of r){const c=t+i,u=n+a;if(ie(c)||ce(u))continue;e[c][u]===f&&o.push({finalCell:{row:c,column:u},updates:g.updateFactory({finalRow:c,finalColumn:u},s,new g(t,n))})}return o}class E{constructor(t,n,{flaggedCell:r}={}){v(this,"grid");v(this,"turn");v(this,"flaggedCell");v(this,"piecesThatCanMove");this.grid=t,this.turn=n,this.flaggedCell=r,this.piecesThatCanMove=this.getPiecesThatCanMove()}updatedGrid(t){const n=E.computeGrid(this.grid,t);return new E(n,this.turn)}updateFlaggedCell(t){return new E(this.grid,this.turn,{flaggedCell:t})}updateCurrentTurn(){const t=this.grid;return new E(t,oe(this.turn))}getPiecesThatCanMove(){return(this.flaggedCell!=null?[this.flaggedCell]:V(this.grid,this.turn)).filter(({row:t,column:n})=>this.getLegalTargets(t,n).length)}getLegalTargets(t,n){return se(this,{startRow:t,startColumn:n}).map(({finalCell:r})=>r)}static computeGrid(t,n){const r=xe(t);return n.forEach(({indices:{row:o,column:s},value:i})=>{r[o][s]=i}),r}serialize(){const t=["b","B","r","R","-"];return{grid:this.grid.map(n=>n.map(r=>t[r]).join("")).join(`
`),turn:this.turn}}}const U={turn:A.black,grid:`
-r-r-r-r
r-r-r-r-
-r-r-r-r
--------
--------
b-b-b-b-
-b-b-b-b
b-b-b-b-
`.trim().split(`
`).filter(Boolean).join(`
`)},J="state",q="grid",K="turn",{pathname:le,href:Ae}=window.location,Ne=()=>{try{const e=localStorage.getItem(J);if(!e)throw new Error("State Not Found");return JSON.parse(e)}catch{}},ke=()=>{const e=new URLSearchParams(window.location.search),t=e.get(q),n=e.get(K);return t?{grid:t,turn:n}:void 0},ue=()=>(window.location.search?ke():Ne())||U,Ie=({grid:e,turn:t}=U)=>{const n=new URLSearchParams;n.set(q,e),n.set(K,t),history.pushState(null,"",`${le}?${n.toString()}`),localStorage.setItem(J,JSON.stringify({grid:e,turn:t}))},Ue=()=>{history.pushState(null,"",le),localStorage.removeItem(J)};function ze(){const e=new URLSearchParams,{grid:t,turn:n}=ue();return e.set(q,t),e.set(K,n),`${Ae.split("?")[0]}?${e.toString()}`}const Be={fetch:ue,persist:Ie,reset:Ue,compileSharingUrl:ze},{fetch:Ge,persist:Ye,reset:Re,compileSharingUrl:Xe}=Be,b={get serialized(){return Ge()},set serialized({grid:e,turn:t}){Ye({grid:e,turn:t})},reset:Re,get share(){return Xe()}};let C=[b.serialized],w=0;const M={resetStack:()=>{C=[U],w=0},add:e=>{C[++w]=e,C.splice(w+1)},dec:()=>C[--w],inc:()=>C[++w],get isEmpty(){return w===0},get isEnd(){return w===C.length-1}},h=e=>{const t=document.getElementById(e);if(t==null)throw new Error(`${e} element does not exist`);return t},D=h("table"),je=h("turnDiv"),F=h("trailingDiv"),Y=h("containerBoard"),He=h("reset"),Ve=h("share"),R=h("undo"),X=h("redo"),z=e=>(t,n)=>{t.addEventListener(e,n)},P=z("click"),Je=z("mousedown"),qe=z("mouseover"),Ke=z("touchstart"),_e="legal-target",de="can-move",_=T.map((e,t)=>`piece-${T[t]}`),Qe=_[f],We=Object.fromEntries(x.map(e=>[e,`piece-${e}`])),ge=(e,t)=>D.rows[e].cells[t],ee=e=>{const t=new Set(e.map(({row:n,column:r})=>`${n},${r}`));return(n,r)=>t.has(`${n},${r}`)};let N=!1;const fe=e=>{re((t,n)=>{e(t,n,ge(t,n))})},Ze=(e,t,n,r)=>{je.className=We[t],R.disabled=M.isEmpty,X.disabled=M.isEnd;const o=ee(n),s=ee(r);fe((i,a,c)=>{const u=e[i][a];let d=`${_[u]} `;o(i,a)&&(d+=`${_e} `),!N&&s(i,a)&&(d+=de),c.className!==d&&(c.className=d)})},et=e=>{Je(D,n=>{t(n,{moveEvent:"mousemove",endEvent:"mouseup",coordsExtractor:r=>r})}),Ke(D,n=>{t(n,{moveEvent:"touchmove",endEvent:"touchend",coordsExtractor:r=>r.changedTouches[0]})});function t(n,{moveEvent:r,endEvent:o,coordsExtractor:s}){const{clientX:i,clientY:a}=s(n),{row:c,column:u}=te({clientX:i,clientY:a}),y=new Set(Array.from(ge(c,u).classList)),d=y.has.bind(y);if(!d(de)||d(Qe))return;N=!0,Y.addEventListener(r,Z),Y.addEventListener(o,Le,{once:!0});const $=_.find(d);typeof $=="string"&&(F.className=$);const{width:B,height:be}=F.getBoundingClientRect();e.updateUI(c,u);const Q=(p,m)=>{F.style.transform=`translateX(${p}px) translateY(${m}px)`},{x:ye,y:Ce}=me({clientX:i,clientY:a}),Ee=ye%B,Te=Ce%be,W=({clientX:p,clientY:m})=>{Q(p-Ee,m-Te)};W({clientX:i,clientY:a});function Z(p){const{clientX:m,clientY:G}=s(p);W({clientX:m,clientY:G})}function Le(p){Y.removeEventListener(r,Z),F.style.backgroundImage="",Q(-1e3,-1e3),N=!1;const{row:m,column:G}=te(s(p));e.handleMove(m,G,c,u)}}};let{left:he,top:pe,width:j,height:H}=D.getBoundingClientRect();window.onresize=()=>({left:he,top:pe,width:j,height:H}=D.getBoundingClientRect());function me({clientX:e,clientY:t}){const n=he+window.pageXOffset,r=pe+window.pageYOffset,o=e-n,s=t-r;return{x:o,y:s}}function te({clientX:e,clientY:t}){const{x:n,y:r}=me({clientX:e,clientY:t});return n>j||r>H?{row:-1,column:-1}:{row:Math.floor(r/H*8),column:Math.floor(n/j*8)}}const S={updateDOM({grid:e,turn:t,legalTargets:n,piecesThatCanMove:r}){Ze(e,t,n,r)},registerShare:e=>{P(Ve,e)},registerUndo:(e,t)=>{P(R,e),P(X,t),window.addEventListener("keydown",({key:n})=>{n==="ArrowLeft"&&!R.disabled&&e(),n==="ArrowRight"&&!X.disabled&&t()})},registerReset:e=>{P(He,e)},registerHover(e){fe((t,n,r)=>{qe(r,()=>{N||e(t,n)})})},registerDrag(e){et(e)}};function ve(e,t=2e3){const n=document.createElement("div");n.classList.add("toast"),n.innerText=e,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},t)}function tt(e,t,n,r){if(l.grid[e][t]!==f||e===-1&&t===-1){O(l);return}const s=Oe(l,{finalRow:e,finalColumn:t,startRow:n,startColumn:r});if(s.length>0){const a=l.updatedGrid(s),c=s.length===3&&T[s[s.length-1].value].split("-")[1]!=="king"||s.length===4,u=I(a.grid,e,t).length!==0;l=c&&u?a.updateFlaggedCell({row:e,column:t}):a.updateFlaggedCell().updateCurrentTurn(),Pe(l.grid,l.turn)&&(ve(`${l.turn} lost! :(`,5e3),we())}O(l);const i=l.serialize();b.serialized=i,M.add(i)}function k({grid:e,turn:t}){const n=De(e).trim().split(`
`).map(s=>s.trim()),o=Array.from({length:8},()=>Array.from({length:8})).map((s,i)=>s.map((a,c)=>Number(n[i].charAt(c))));return O(new E(o,t))}let l=k(b.serialized);function we(){M.resetStack(),b.reset(),l=k(U)}function O(e,t=[]){return S.updateDOM({grid:e.grid,turn:e.turn,legalTargets:t,piecesThatCanMove:e.piecesThatCanMove}),e}S.registerDrag({handleMove:tt,updateUI:(e,t)=>{O(l.updatedGrid([new g(e,t,f)]),l.getLegalTargets(e,t))}});S.registerShare(()=>{navigator.clipboard.writeText(b.share).then(()=>{ve("URL with game-state copied to clipboard! ðŸŽ†ðŸŽ†ðŸŽ†")}).catch(console.error)});S.registerReset(we);S.registerHover((e,t)=>O(l,l.getLegalTargets(e,t)));S.registerUndo(()=>{l=k(M.dec()),b.serialized=l.serialize()},()=>{l=k(M.inc()),b.serialized=l.serialize()});
//# sourceMappingURL=index-6854ce07.js.map
