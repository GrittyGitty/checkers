(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const x=["black","black-king","red","red-king","empty"],oe=[[-1],[-1,1],[1],[-1,1]],Ce=oe.map(n=>n.map(e=>e*2)),$=["black","red"],w=x.length-1,Ee=(...n)=>{const e=Object.entries(n.pop()).filter(([,t])=>Boolean(t)).map(([t])=>t);return[...n,...e].join(" ")},B={turn:"black",grid:`
-r-r-r-r
r-r-r-r-
-r-r-r-r
--------
--------
b-b-b-b-
-b-b-b-b
b-b-b-b-
`.trim().split(`
`).filter(Boolean).join(`
`)};class T{constructor(e,t,r=w){this.indices={row:e,column:t},this.value=r}static updateFactory(e,t,...r){let o=[];return o.push(new T(e.finalRow,e.finalColumn,t)),r.forEach(({indices:s})=>o.push(new T(s.row,s.column))),o}}function se(n){for(let e=0;e<8;e++)for(let t=0;t<8;t++)n(e,t)}const F=(()=>{const n=i=>document.getElementById(i),e=n("table"),t=n("turnDiv"),r=n("trailingDiv"),o=n("containerBoard"),s=n("reset"),l=n("share"),d=n("undo"),u=n("redo"),[p,y,f,v,b]=["click","mousedown","mouseover","keydown","touchstart"].map(i=>(a,c)=>a.addEventListener(i,c)),de="legal-target",V="can-move",R=x.map((i,a)=>`piece-${x[a]}`),ge=R[w],pe=Object.fromEntries($.map(i=>[i,`piece-${i}`])),J=(i,a)=>e.rows[i].cells[a],q=i=>{const a=new Set(i.map(({row:c,column:h})=>`${c},${h}`));return(c,h)=>a.has(`${c},${h}`)};let Y=!1;const K=i=>se((a,c)=>i({row:a,column:c,domCell:J(a,c)})),he=(i,{legalTargets:a,piecesThatCanMove:c,turn:h})=>{t.className=pe[h],d.disabled=O===0,u.disabled=O===D.length-1;const E=q(a),M=q(c);K(({row:L,column:C,domCell:k})=>{const P=i[L][C],N=Ee(R[P],{[de]:E(L,C),[V]:M(L,C)&&!Y});k.className!==N&&(k.className=N)})};y(e,i=>{Q(i,{moveEvent:"mousemove",endEvent:"mouseup",coordsExtractor:a=>a})}),b(e,i=>{Q(i,{moveEvent:"touchmove",endEvent:"touchend",coordsExtractor:a=>a.changedTouches[0]})});function Q(i,{moveEvent:a,endEvent:c,coordsExtractor:h}){const{clientX:E,clientY:M}=h(i);let{row:L,column:C}=ee({clientX:E,clientY:M});const k=new Set(J(L,C).classList),P=k.has.bind(k);if(!P(V)||P(ge))return;Y=!0,o.addEventListener(a,re),o.addEventListener(c,Le,{once:!0}),r.className=R.find(P);const{width:N,height:me}=r.getBoundingClientRect(),ve=g.getLegalTargets(L,C);g.updatedGrid([new T(L,C,w)]).updateUI(ve);const te=(S,I)=>r.style.transform=`translateX(${S}px) translateY(${I}px)`,{x:be,y:Te}=_({clientX:E,clientY:M}),we=be%N,ye=Te%me,ne=({clientX:S,clientY:I})=>te(S-we,I-ye);ne({clientX:E,clientY:M});function re(S){const{clientX:I,clientY:X}=h(S);ne({clientX:I,clientY:X})}function Le(S){o.removeEventListener(a,re),r.style.backgroundImage="",te(-1e3,-1e3),Y=!1;let{row:I,column:X}=ee(h(S));m.handleMove(I,X,L,C)}}let{left:W,top:Z,width:j,height:z}=e.getBoundingClientRect();function _({clientX:i,clientY:a}){const c=W+window.pageXOffset,h=Z+window.pageYOffset,E=i-c,M=a-h;return{x:E,y:M}}function ee({clientX:i,clientY:a}){const{x:c,y:h}=_({clientX:i,clientY:a});return c>j||h>z?{row:-1,column:-1}:{row:Math.floor(h/z*8),column:Math.floor(c/j*8)}}function fe(i,a=2e3){const c=document.createElement("div");c.classList.add("toast"),c.innerText=i,document.body.appendChild(c),setTimeout(()=>{document.body.removeChild(c)},a)}return window.onresize=()=>({left:W,top:Z,width:j,height:z}=e.getBoundingClientRect()),{updateUI({grid:i,turn:a,legalTargets:c,piecesThatCanMove:h}){he(i,{legalTargets:c,piecesThatCanMove:h,turn:a})},registerShare:i=>p(l,i),registerUndo:(i,a)=>{p(d,i),p(u,a),v(window,({key:c})=>{c==="ArrowLeft"&&!d.disabled&&i(),c==="ArrowRight"&&!u.disabled&&a()})},registerReset:i=>p(s,i),registerHover(i){K(({domCell:a,row:c,column:h})=>{f(a,()=>i(c,h))})},toast:fe}})();class m{constructor(e,t,{flaggedCell:r}={}){this.grid=e,this.currentTurn=t,this.flaggedCell=r,this.piecesThatCanMove=this.getPiecesThatCanMove()}updatedGrid(e){let t=m.computeGrid(this.grid,e);return new m(t,this.currentTurn)}updateFlaggedCell(e=void 0){return new m(this.grid,this.currentTurn,{flagged:e})}updateCurrentTurn(){let e=this.grid;return new m(e,m.oppositeColor(this.currentTurn))}getPiecesThatCanMove(){return H(this.grid,this.currentTurn).filter(({row:e,column:t})=>this.getLegalTargets(e,t).length)}updateUI(e=[]){return F.updateUI({grid:this.grid,turn:this.currentTurn,legalTargets:e,piecesThatCanMove:this.piecesThatCanMove}),this}getLegalTargets(e,t){return ie(this,{startRow:e,startColumn:t}).map(({finalCell:r})=>r)}static oppositeColor(e){return e===$[0]?$[1]:$[0]}static computeGrid(e,t){let r=Fe(e);return t.forEach(({indices:{row:o,column:s},value:l})=>{r[o][s]=l}),r}static handleMove(e,t,r,o){if(g.grid[e][t]!==w||e===-1&&t===-1)return g.updateUI();let l=Me(g,{finalRow:e,finalColumn:t,startRow:r,startColumn:o});if(l.length>0){let u=g.updatedGrid(l),p=l.length===3&&x[l[l.length-1].value].split("-")[1]!=="king"||l.length===4,y=G(u.grid,e,t).length!==0;g=p&&y?u.updateFlaggedCell({row:e,column:t}):u.updateFlaggedCell().updateCurrentTurn(),Ie(g.grid,g.currentTurn)&&(F.toast(`${g.currentTurn} lost! :(`,5e3),ue())}g.updateUI();const d=g.serialize();U.state=d,D[++O]=d,D.splice(O+1)}static startSession({grid:e,turn:t}){const r=Ue(e).trim().split(`
`).map(s=>s.trim()),o=new Array(r.length).fill(new Array(r[0].length).fill(0)).map((s,l)=>s.map((d,u)=>Number(r[l].charAt(u))));return new m(o,t).updateUI()}serialize(){const e=["b","B","r","R","-"];return{grid:this.grid.map(t=>t.map(r=>e[r]).join("")).join(`
`),turn:this.currentTurn}}}function Me(n,{finalRow:e,finalColumn:t,startRow:r,startColumn:o}){const l=ie(n,{startRow:r,startColumn:o}).find(({finalCell:u})=>u.row===e&&u.column===t);if(!l)return[];const{updates:d}=l;return(e===7||e===0)&&d.length>0&&d.push(new T(e,t,x.indexOf(A(n.grid[r][o])+"-king"))),d}function ie({grid:n,flaggedCell:e,currentTurn:t},{startRow:r,startColumn:o}){const s=n[r][o];return s===w||A(s)!==t||r===(e==null?void 0:e.row)&&o===(e==null?void 0:e.column)?[]:Se(n,A(n[r][o]))?G(n,r,o):ae(n,r,o)}function Se(n,e){return H(n,e).some(({row:t,column:r})=>G(n,t,r).length>0)}function A(n){return n!==w?x[n].split("-")[0]:"empty"}function G(n,e,t){const r=[2,-2];let o=[],s=n[e][t];if(s===w)return o;for(let l of Ce[s])for(let d of r){let u=e+l,p=t+d;if(ce(u)||le(p))continue;let y=n[u][p],f=e+(Math.abs(l)-1)*Math.sign(l),v=t+(Math.abs(d)-1)*Math.sign(d),b=n[f][v];y===w&&A(b)===m.oppositeColor(A(s))&&o.push({finalCell:{row:u,column:p},updates:T.updateFactory({finalRow:u,finalColumn:p},s,new T(f,v),new T(e,t))})}return o}function ae(n,e,t){const r=[1,-1];let o=[],s=n[e][t];if(s===w)return o;for(let l of oe[s])for(let d of r){let u=e+l,p=t+d;if(ce(u)||le(p))continue;n[u][p]===w&&o.push({finalCell:{row:u,column:p},updates:T.updateFactory({finalRow:u,finalColumn:p},s,new T(e,t))})}return o}function H(n,e){const t=[];return se((r,o)=>{A(n[r][o])===e&&t.push({row:r,column:o})}),t}function Ie(n,e){return!H(n,e).some(({row:t,column:r})=>G(n,t,r).length>0||ae(n,t,r).length>0)}const Fe=n=>n.map(e=>e.map(t=>t));function ce(...n){return n.some(e=>e>=8||e<0)}function le(...n){return n.some(e=>e>=8||e<0)}function Ue(n){return["b","B","r","R","-"].reduce((e,t,r)=>e.replaceAll(t,r),n)}const Oe=(()=>{const n="state",e="grid",t="turn",{pathname:r,href:o}=window.location,s=()=>{try{return JSON.parse(localStorage.getItem(n))}catch{return}},l=()=>{const f=new URLSearchParams(window.location.search),v=f.get(e),b=f.get(t);return v?{grid:v,turn:b}:void 0},d=()=>(window.location.search?l():s())||B,u=({grid:f,turn:v}=B)=>{const b=new URLSearchParams;b.set(e,f),b.set(t,v),history.pushState(null,"",`${r}?${b.toString()}`),localStorage.setItem(n,JSON.stringify({grid:f,turn:v}))},p=()=>{history.pushState(null,"",r),localStorage.removeItem(n)};function y(){const f=new URLSearchParams,{grid:v,turn:b}=d();return f.set(e,v),f.set(t,b),`${o.split("?")[0]}?${f.toString()}`}return{fetch:d,persist:u,reset:p,compileSharingUrl:y}})(),U=(()=>{const{fetch:n,persist:e,reset:t,compileSharingUrl:r}=Oe;return{get state(){return n()},set state({grid:o,turn:s}){e({grid:o,turn:s})},reset:t,get share(){return r()}}})();function ue(){g=m.startSession(B),D=[B],O=0,U.reset()}F.registerShare(()=>{navigator.clipboard.writeText(U.share).then(()=>{F.toast("URL with game-state copied to clipboard! \u{1F386}\u{1F386}\u{1F386}")})});F.registerReset(ue);F.registerHover((n,e)=>g.updateUI(g.getLegalTargets(n,e)));F.registerUndo(()=>{g=m.startSession(D[--O]),U.state=g.serialize()},()=>{g=m.startSession(D[++O]),U.state=g.serialize()});let D=[U.state],O=0,g=m.startSession(U.state);
//# sourceMappingURL=index.ee01fd2c.js.map
