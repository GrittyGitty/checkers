var Ae=Object.defineProperty;var Fe=(e,t,n)=>t in e?Ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var b=(e,t,n)=>(Fe(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();var O=(e=>(e.black="black",e.red="red",e))(O||{});const T=["black","black-king","red","red-king","empty"],ie=[[-1],[-1,1],[1],[-1,1]],ke=ie.map(e=>e.map(t=>t*2)),k=[O.black,O.red],f=T.length-1,xe=O.red;class g{constructor(t,n,r=f){b(this,"indices");b(this,"value");this.indices={row:t,column:n},this.value=r}static updateFactory(t,n,...r){const o=[];return o.push(new g(t.finalRow,t.finalColumn,n)),r.forEach(({indices:s})=>o.push(new g(s.row,s.column))),o}}function J(e){for(let t=0;t<8;t++)for(let n=0;n<8;n++)e(t,n)}const y=T.map((e,t)=>t!==f?T[t].split("-")[0]:void 0);function Re(e){return["b","B","r","R","-"].reduce((t,n,r)=>t.replaceAll(n,String(r)),e)}function ce(e){return e===k[0]?k[1]:k[0]}const N={turn:O.black,grid:`
-r-r-r-r
r-r-r-r-
-r-r-r-r
--------
--------
b-b-b-b-
-b-b-b-b
b-b-b-b-
`.trim().split(`
`).filter(Boolean).join(`
`)},Ge=e=>{const t=Re(e).trim().split(`
`).map(r=>r.trim());return Array.from({length:8},()=>Array.from({length:8})).map((r,o)=>r.map((s,i)=>Number(t[o].charAt(i))))};function ae(e,{finalRow:t,finalColumn:n,startRow:r,startColumn:o}){const i=le(e,{startRow:r,startColumn:o}).find(({finalCell:a})=>a.row===t&&a.column===n);if(i==null)return[];const{updates:c}=i;return(t===7||t===0)&&c.length>0&&c.push(new g(t,n,T.indexOf(`${y[e.grid[r][o]]}-king`))),c}function le({grid:e,turn:t},{startRow:n,startColumn:r}){const o=e[n][r];return o===f||y[o]!==t?[]:Ne(e,y[e[n][r]])?U(e,n,r):ge(e,n,r)}function Ne(e,t){return _(e,t).some(({row:n,column:r})=>U(e,n,r).length>0)}function U(e,t,n){const r=[2,-2],o=[],s=e[t][n];if(s===f)return o;for(const i of ke[s])for(const c of r){const a=t+i,u=n+c;if(ue(a)||de(u))continue;const h=e[a][u],d=t+(Math.abs(i)-1)*Math.sign(i),p=n+(Math.abs(c)-1)*Math.sign(c),z=e[d][p];h===f&&y[z]===ce(y[s])&&o.push({finalCell:{row:a,column:u},updates:g.updateFactory({finalRow:a,finalColumn:u},s,new g(d,p),new g(t,n))})}return o}function _(e,t){const n=[];return J((r,o)=>{y[e[r][o]]===t&&n.push({row:r,column:o})}),n}function Ue(e,t){return!_(e,t).some(({row:n,column:r})=>U(e,n,r).length>0||ge(e,n,r).length>0)}const Ie=e=>e.map(t=>t.map(n=>n));function ue(...e){return e.some(t=>t>=8||t<0)}function de(...e){return e.some(t=>t>=8||t<0)}function ge(e,t,n){const r=[1,-1],o=[],s=e[t][n];if(s===f)return o;for(const i of ie[s])for(const c of r){const a=t+i,u=n+c;if(ue(a)||de(u))continue;e[a][u]===f&&o.push({finalCell:{row:a,column:u},updates:g.updateFactory({finalRow:a,finalColumn:u},s,new g(t,n))})}return o}class S{constructor(t,n,{flaggedCell:r}={}){b(this,"grid");b(this,"turn");b(this,"flaggedCell");b(this,"piecesThatCanMove");this.grid=t,this.turn=n,this.flaggedCell=r,this.piecesThatCanMove=this.getPiecesThatCanMove()}updatedGrid(t){const n=S.computeGrid(this.grid,t);return new S(n,this.turn)}updateFlaggedCell(t){return new S(this.grid,this.turn,{flaggedCell:t})}updateCurrentTurn(){const t=this.grid;return new S(t,ce(this.turn))}getPiecesThatCanMove(){return(this.flaggedCell!=null?[this.flaggedCell]:_(this.grid,this.turn)).filter(({row:t,column:n})=>this.getLegalTargets(t,n).length)}getLegalTargets(t,n){return le(this,{startRow:t,startColumn:n}).map(({finalCell:r})=>r)}static computeGrid(t,n){const r=Ie(t);return n.forEach(({indices:{row:o,column:s},value:i})=>{r[o][s]=i}),r}serialize(){const t=["b","B","r","R","-"];return{grid:this.grid.map(n=>n.map(r=>t[r]).join("")).join(`
`),turn:this.turn}}}const q="state",K="grid",Q="turn",{pathname:fe,href:ze}=window.location,Be=()=>{try{const e=localStorage.getItem(q);if(!e)throw new Error("State Not Found");return JSON.parse(e)}catch{}},Ye=()=>{const e=new URLSearchParams(window.location.search),t=e.get(K),n=e.get(Q);return t?{grid:t,turn:n}:void 0},he=()=>(window.location.search?Ye():Be())||N,Xe=({grid:e,turn:t}=N)=>{const n=new URLSearchParams;n.set(K,e),n.set(Q,t),history.pushState(null,"",`${fe}?${n.toString()}`),localStorage.setItem(q,JSON.stringify({grid:e,turn:t}))},He=()=>{history.pushState(null,"",fe),localStorage.removeItem(q)};function je(){const e=new URLSearchParams,{grid:t,turn:n}=he();return e.set(K,t),e.set(Q,n),`${ze.split("?")[0]}?${e.toString()}`}const Ve={fetch:he,persist:Xe,reset:He,compileSharingUrl:je},{fetch:Je,persist:_e,reset:qe,compileSharingUrl:Ke}=Ve,E={get serialized(){return Je()},set serialized({grid:e,turn:t}){_e({grid:e,turn:t})},reset:qe,get share(){return Ke()}};let L=[E.serialized],C=0;const $={resetStack:()=>{L=[N],C=0},add:e=>{L[++C]=e,L.splice(C+1)},dec:()=>L[--C],inc:()=>L[++C],get isEmpty(){return C===0},get isEnd(){return C===L.length-1}},m=e=>{const t=document.getElementById(e);if(t==null)throw new Error(`${e} element does not exist`);return t},P=m("table"),Qe=m("turnDiv"),F=m("trailingDiv"),Y=m("containerBoard"),We=m("reset"),Ze=m("share"),X=m("undo"),H=m("redo"),et=m("ai"),I=e=>(t,n)=>{t.addEventListener(e,n)},D=I("click"),tt=I("mousedown"),nt=I("mouseover"),rt=I("touchstart"),ot="legal-target",pe="can-move",W=T.map((e,t)=>`piece-${T[t]}`),st=W[f],it=Object.fromEntries(k.map(e=>[e,`piece-${e}`])),me=(e,t)=>P.rows[e].cells[t],re=e=>{const t=new Set(e.map(({row:n,column:r})=>`${n},${r}`));return(n,r)=>t.has(`${n},${r}`)};let R=!1;const ve=e=>{J((t,n)=>{e(t,n,me(t,n))})},ct=(e,t,n,r)=>{Qe.className=it[t],X.disabled=$.isEmpty,H.disabled=$.isEnd;const o=re(n),s=re(r);ve((i,c,a)=>{const u=e[i][c];let d=`${W[u]} `;o(i,c)&&(d+=`${ot} `),!R&&s(i,c)&&(d+=pe),a.className!==d&&(a.className=d)})},at=e=>{tt(P,n=>{t(n,{moveEvent:"mousemove",endEvent:"mouseup",coordsExtractor:r=>r})}),rt(P,n=>{t(n,{moveEvent:"touchmove",endEvent:"touchend",coordsExtractor:r=>r.changedTouches[0]})});function t(n,{moveEvent:r,endEvent:o,coordsExtractor:s}){const{clientX:i,clientY:c}=s(n),{row:a,column:u}=oe({clientX:i,clientY:c}),h=new Set(Array.from(me(a,u).classList)),d=h.has.bind(h);if(!d(pe)||d(st))return;R=!0,Y.addEventListener(r,ne),Y.addEventListener(o,Pe,{once:!0});const p=W.find(d);typeof p=="string"&&(F.className=p);const{width:z,height:Le}=F.getBoundingClientRect();e.updateUI(a,u);const ee=(v,w)=>{F.style.transform=`translateX(${v}px) translateY(${w}px)`},{x:Se,y:$e}=Ce({clientX:i,clientY:c}),De=Se%z,Oe=$e%Le,te=({clientX:v,clientY:w})=>{ee(v-De,w-Oe)};te({clientX:i,clientY:c});function ne(v){const{clientX:w,clientY:B}=s(v);te({clientX:w,clientY:B})}function Pe(v){Y.removeEventListener(r,ne),F.style.backgroundImage="",ee(-1e3,-1e3),R=!1;const{row:w,column:B}=oe(s(v));e.handleMove(w,B,a,u)}}};let{left:we,top:be,width:j,height:V}=P.getBoundingClientRect();window.onresize=()=>({left:we,top:be,width:j,height:V}=P.getBoundingClientRect());function Ce({clientX:e,clientY:t}){const n=we+window.pageXOffset,r=be+window.pageYOffset,o=e-n,s=t-r;return{x:o,y:s}}function oe({clientX:e,clientY:t}){const{x:n,y:r}=Ce({clientX:e,clientY:t});return n>j||r>V?{row:-1,column:-1}:{row:Math.floor(r/V*8),column:Math.floor(n/j*8)}}const M={updateDOM({grid:e,turn:t,legalTargets:n,piecesThatCanMove:r}){ct(e,t,n,r)},registerShare:e=>{D(Ze,e)},registerUndo:(e,t)=>{D(X,e),D(H,t),window.addEventListener("keydown",({key:n})=>{n==="ArrowLeft"&&!X.disabled&&e(),n==="ArrowRight"&&!H.disabled&&t()})},registerReset:e=>{D(We,e)},registerHover(e){ve((t,n,r)=>{nt(r,()=>{R||e(t,n)})})},registerDrag(e){at(e)},registerAi(e){D(et,e)}};function Te(e,t=2e3){const n=document.createElement("div");n.classList.add("toast"),n.innerText=e,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n)},t)}const se=({grid:e,turn:t})=>{let n=0;return J((r,o)=>{const s=e[r][o],i=y[s];if(!i)return;let c=0;switch(s){case 0:c=1;break;case 1:c=2;break;case 2:c=1;break;case 3:c=2;break}n+=i===t?c:-c}),n},lt=5;function ye(e,t=lt){const n=se(e);let r={score:0,move:{finalColumn:0,finalRow:0,startColumn:0,startRow:0}};for(const{row:o,column:s}of e.getPiecesThatCanMove())for(const{row:i,column:c}of e.getLegalTargets(o,s)){const a={finalRow:i,finalColumn:c,startRow:o,startColumn:s},u=ae(e,a),h=e.updatedGrid(u);let p=se(h)-n;t&&(p+=ye(h.updateCurrentTurn(),t-1).score),p>=r.score&&(r={score:p,move:a})}return r}const Ee=(e,t)=>{e.turn===xe&&setTimeout(()=>{const n=performance.now(),{move:{finalRow:r,finalColumn:o,startRow:s,startColumn:i}}=ye(e),c=performance.now()-n,a=Math.max(400-c,0);setTimeout(()=>{t(r,o,s,i)},a)},50)};let x=!0;function Z(e,t,n,r){if(l.grid[e][t]!==f||e===-1&&t===-1){A(l);return}const s=ae(l,{finalRow:e,finalColumn:t,startRow:n,startColumn:r});if(s.length>0){const c=l.updatedGrid(s),a=s.length===3&&T[s[s.length-1].value].split("-")[1]!=="king"||s.length===4,u=U(c.grid,e,t).length!==0;l=a&&u?c.updateFlaggedCell({row:e,column:t}):c.updateFlaggedCell().updateCurrentTurn(),Ue(l.grid,l.turn)&&(Te(`${l.turn} lost! :(`,5e3),Me())}A(l);const i=l.serialize();E.serialized=i,$.add(i),x&&Ee(l,Z)}function G({grid:e,turn:t}){const n=Ge(e);return A(new S(n,t))}let l=G(E.serialized);function Me(){$.resetStack(),E.reset(),l=G(N)}function A(e,t=[]){return M.updateDOM({grid:e.grid,turn:e.turn,legalTargets:t,piecesThatCanMove:e.piecesThatCanMove}),e}M.registerDrag({handleMove:Z,updateUI:(e,t)=>{A(l.updatedGrid([new g(e,t,f)]),l.getLegalTargets(e,t))}});M.registerShare(()=>{navigator.clipboard.writeText(E.share).then(()=>{Te("URL with game-state copied to clipboard! 🎆🎆🎆")}).catch(console.error)});M.registerReset(Me);M.registerHover((e,t)=>A(l,l.getLegalTargets(e,t)));M.registerUndo(()=>{l=G($.dec()),E.serialized=l.serialize()},()=>{l=G($.inc()),E.serialized=l.serialize()});M.registerAi(()=>{x=!x,x&&Ee(l,Z)});
//# sourceMappingURL=index-190cf491.js.map
